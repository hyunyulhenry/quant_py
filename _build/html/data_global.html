
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>11. ì „ ì„¸ê³„ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸° &#8212; íŒŒì´ì¬ì„ ì´ìš©í•œ í€€íŠ¸ íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ ë§Œë“¤ê¸°</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "hyunyulhenry/quant_py");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "ğŸ’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="12. íˆ¬ì ì°¸ê³ ìš© ë°ì´í„° ìˆ˜ì§‘" href="data_ref.html" />
    <link rel="prev" title="10. êµ­ë‚´ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘" href="data_korea.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">íŒŒì´ì¬ì„ ì´ìš©í•œ í€€íŠ¸ íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ ë§Œë“¤ê¸°</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   íŒŒì´ì¬ì„ ì´ìš©í•œ í€€íŠ¸ íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ ë§Œë“¤ê¸°
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  í€€íŠ¸ì™€ í”„ë¡œê·¸ë˜ë° ê¸°ì´ˆ ë°°ì›Œë³´ê¸°
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="quant_intro.html">
   1. í€€íŠ¸ì— ëŒ€í•´ ì•Œì•„ë³´ê¸°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="python.html">
   2. íŒŒì´ì¬ ê¸°ì´ˆ ë°°ì›Œë³´ê¸°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eda.html">
   3. ë°ì´í„° ë¶„ì„ ë°°ì›Œë³´ê¸°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plot.html">
   4. ë°ì´í„° ì‹œê°í™” ë°°ì›Œë³´ê¸°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sql.html">
   5. SQL ê¸°ì´ˆ ë°°ì›Œë³´ê¸°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sql_in_python.html">
   6. íŒŒì´ì¬ì—ì„œ SQL ì—°ê²°í•˜ê¸°
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  í¬ë¡¤ë§ì„ ì´ìš©í•œ ë°ì´í„° ìˆ˜ì§‘
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="web.html">
   7. í¬ë¡¤ë§ì„ ìœ„í•œ ì›¹ ê¸°ë³¸ì§€ì‹
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="crawl_basic.html">
   8. ì •ì  í¬ë¡¤ë§ ì‹¤ìŠµí•˜ê¸°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="selenium.html">
   9. ë™ì  í¬ë¡¤ë§ê³¼ ì •ê·œ í‘œí˜„ì‹
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data_korea.html">
   10. êµ­ë‚´ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   11. ì „ ì„¸ê³„ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data_ref.html">
   12. íˆ¬ì ì°¸ê³ ìš© ë°ì´í„° ìˆ˜ì§‘
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±, ë°±í…ŒìŠ¤íŠ¸ ë° ë§¤ë§¤í•˜ê¸°
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="factor.html">
   13. í€€íŠ¸ ì „ëµì„ ì´ìš©í•œ ì¢…ëª©ì„ ì •
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="portfolio.html">
   14. í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ì „ëµ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="technical.html">
   15. íŠ¸ë ˆì´ë”©ì„ ìœ„í•œ ê¸°ìˆ ì  ì§€í‘œ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="backtest.html">
   16. ë°±í…ŒìŠ¤íŒ… ì‹œë®¬ë ˆì´ì…˜
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api_trading.html">
   17. ì¦ê¶Œì‚¬ API ì—°ê²°ê³¼ ë§¤ë§¤í•˜ê¸°
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ë¶€ë¡
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install_python.html">
   íŒŒì´ì¬ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜í•˜ê¸°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install_sql.html">
   SQL ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜í•˜ê¸°
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/data_global.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hyunyulhenry/quant_py/main?urlpath=tree/data_global.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   11.1. ìœ ë£Œ ë°ì´í„° ë²¤ë” ì´ìš©í•˜ê¸°
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api-token">
     11.1.1. ê°€ì… ë° API token ë°›ê¸°
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     11.1.2. ë°ì´í„° ë‹¤ìš´ë¡œë“œ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   11.2. í‹°ì»¤ ìˆ˜ì§‘í•˜ê¸°
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     11.2.1. ì „ ì¢…ëª© í‹°ì»¤ í¬ë¡¤ë§
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id6">
   11.3. ì£¼ê°€ ë‹¤ìš´ë¡œë“œ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     11.3.1. ì „ ì¢…ëª© ì£¼ê°€ ë‹¤ìš´ë¡œë“œ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   11.4. ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     11.4.1. ì „ ì¢…ëª© ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>ì „ ì„¸ê³„ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸°</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   11.1. ìœ ë£Œ ë°ì´í„° ë²¤ë” ì´ìš©í•˜ê¸°
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api-token">
     11.1.1. ê°€ì… ë° API token ë°›ê¸°
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     11.1.2. ë°ì´í„° ë‹¤ìš´ë¡œë“œ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   11.2. í‹°ì»¤ ìˆ˜ì§‘í•˜ê¸°
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     11.2.1. ì „ ì¢…ëª© í‹°ì»¤ í¬ë¡¤ë§
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id6">
   11.3. ì£¼ê°€ ë‹¤ìš´ë¡œë“œ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     11.3.1. ì „ ì¢…ëª© ì£¼ê°€ ë‹¤ìš´ë¡œë“œ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   11.4. ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     11.4.1. ì „ ì¢…ëª© ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="id1">
<h1><span class="section-number">11. </span>ì „ ì„¸ê³„ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸°<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h1>
<p>í€€íŠ¸ íˆ¬ìì˜ ì¥ì ì€ ë°ì´í„°ë§Œ ìˆë‹¤ë©´ ë™ì¼í•œ íˆ¬ì ì „ëµì„ ì „ ì„¸ê³„ ëª¨ë“  êµ­ê°€ì— ì ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤. ì´ë²ˆ ì¥ì—ì„œëŠ” ì „ ì„¸ê³„ ì¢…ëª©ì˜ í‹°ì»¤ ìˆ˜ì§‘ ë° ì£¼ê°€, ì¬ë¬´ì œí‘œ, ê°€ì¹˜ì§€í‘œë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ë‹¤.</p>
<div class="section" id="id2">
<h2><span class="section-number">11.1. </span>ìœ ë£Œ ë°ì´í„° ë²¤ë” ì´ìš©í•˜ê¸°<a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h2>
<p>ë¯¸êµ­ ì‹œì¥ì˜ ë°ì´í„°ë§Œ í•„ìš”í•  ê²½ìš° ìœ ë£Œ ë°ì´í„° ë²¤ë”ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²•ì´ë‹¤. ë¯¸êµ­ì—ëŠ” ê¸ˆìœµ ë°ì´í„°ë¥¼ APIë¡œ ì œê³µí•˜ëŠ” ìˆ˜ë§ì€ ì—…ì²´ê°€ ìˆìœ¼ë©°, tiingoì˜ ê²½ìš°ëŠ” ì›” $10ë§Œ ì§€ë¶ˆí•˜ë©´ ë¯¸êµ­ê³¼ ì¤‘êµ­ì˜ 4ë§Œì—¬ê°œ ì¢…ëª©ì— ëŒ€í•œ ë°ì´í„°ë¥¼ API í˜•íƒœë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤. ì´ëŠ” ìƒì¥íì§€ëœ ì¢…ëª©ì„ ì»¤ë²„í•  ë¿ë§Œ ì•„ë‹ˆë¼, APIë¥¼ ì´ìš©í•˜ë¯€ë¡œ í¬ë¡¤ë§ê³¼ëŠ” ë¹„êµí•  ìˆ˜ ì—†ëŠ” ì†ë„ë¡œ ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤. ì´ ì™¸ì—ë„ Alpha Vantage, Quandl, Polygon ë“± ìˆ˜ë§ì€ ë°ì´í„° ë²¤ë”ê°€ ì¡´ì¬í•œë‹¤.</p>
<div class="figure align-default" id="tiingo">
<a class="reference internal image-reference" href="_images/tiingo.png"><img alt="_images/tiingo.png" src="_images/tiingo.png" style="width: 564.1999999999999px; height: 579.5999999999999px;" /></a>
<p class="caption"><span class="caption-number">Fig. 11.1 </span><span class="caption-text">tiingoì˜ ìœ /ë¬´ë£Œ ì„œë¹„ìŠ¤ ë¹„êµ</span><a class="headerlink" href="#tiingo" title="Permalink to this image">Â¶</a></p>
</div>
<p>tiingoëŠ” ë¬´ë£Œ ê³„ì •ë„ í•˜ë£¨ 1,000íšŒê¹Œì§€ API ìš”ì²­ì„ í•  ìˆ˜ ìˆìœ¼ë©°, íŒŒì´ì¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íŒ¨í‚¤ì§€ë„ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•´ë³´ë„ë¡ í•˜ê² ë‹¤.</p>
<div class="section" id="api-token">
<h3><span class="section-number">11.1.1. </span>ê°€ì… ë° API token ë°›ê¸°<a class="headerlink" href="#api-token" title="Permalink to this headline">Â¶</a></h3>
<p>ë¨¼ì € <a class="reference external" href="https://api.tiingo.com/">https://api.tiingo.com/</a> ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ì—¬ ìš°ì¸¡ ìƒë‹¨ì˜ [Sign-up]ì„ í´ë¦­í•´ íšŒì›ê°€ì…ì„ í•œë‹¤. ê·¸ í›„ ë¡œê·¸ì¸ì„ í•œ í›„ ìš°ì¸¡ ìƒë‹¨ì—ì„œ ë³¸ì¸ì˜ IDë¥¼ í´ë¦­í•œ í›„ [Account]ë¥¼ ì„ íƒ, ì¢Œì¸¡ ë©”ë‰´ì˜ [API] ë¶€ë¶„ì—ì„œ [Token]ì„ í´ë¦­í•˜ë©´ ë³¸ì¸ì˜ API tokenì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<div class="figure align-default" id="token">
<img alt="_images/token1.png" src="_images/token1.png" />
<p class="caption"><span class="caption-number">Fig. 11.2 </span><span class="caption-text">API token í™•ì¸</span><a class="headerlink" href="#token" title="Permalink to this image">Â¶</a></p>
</div>
<p>ë°œê¸‰ë°›ì€ í† í°ì„ PCì— ì €ì¥í•  ê²½ìš°, keyring íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ë©´ ì•ˆì „í•˜ê²Œ ì €ì¥í•  ìˆ˜ ìˆë‹¤. íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•´ ì•”í˜¸ë‚˜ í‚¤ ê°’ì„ ì €ì¥í•˜ëŠ” ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">keyring</span>

<span class="n">keyring</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;System&#39;</span><span class="p">,</span> <span class="s1">&#39;User Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Password&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[System]ì—ëŠ” ì‹œìŠ¤í…œ ì¢…ë¥˜, [User Name]ì—ëŠ” ë³¸ì¸ì˜ ì´ë¦„, [Password]ì—ëŠ” ë°œê¸‰ë°›ì€ API Keyë¥¼ ì…ë ¥í•œë‹¤. í•œë²ˆ ì…ë ¥ëœ ê°’ì€ ê³„ì† ì €ì¥ë˜ì–´ ìˆë‹¤. ì €ì¥í•œ í‚¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">api_key</span> <span class="o">=</span> <span class="n">keyring</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="s1">&#39;System&#39;</span><span class="p">,</span> <span class="s1">&#39;User Name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>ì´ì œ â€˜Sysyemâ€™ì—ëŠ” â€˜tiingoâ€™, â€˜User Nameâ€™ì—ëŠ” ë³¸ì¸ì˜ ì´ë¦„, â€˜Passwordâ€™ì—ëŠ” ìœ„ì—ì„œ ë°œê¸‰ë°›ì€ API Tokenì„ ì…ë ¥í•´ í† í°ì„ ì €ì¥í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">keyring</span>

<span class="n">keyring</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;tiingo&#39;</span><span class="p">,</span> <span class="s1">&#39;User Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Your API Token&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3><span class="section-number">11.1.2. </span>ë°ì´í„° ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h3>
<p>tiingo íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•´ ë°ì´í„°ë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ê² ë‹¤. ë°ì´í„°ë¥¼ ë°›ê¸°ìœ„í•´ API ì ‘ì†í™˜ê²½ì„ ì…‹íŒ…í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tiingo</span> <span class="kn">import</span> <span class="n">TiingoClient</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">keyring</span>

<span class="n">api_key</span> <span class="o">=</span> <span class="n">keyring</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="s1">&#39;tiingo&#39;</span><span class="p">,</span> <span class="s1">&#39;Henry&#39;</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_key</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">TiingoClient</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>API tokenì„ ë¶ˆëŸ¬ì˜¨ í›„, ì ‘ì†í™˜ê²½ì— í•´ë‹¹í•˜ëŠ” configì— ì´ë¥¼ ì…ë ¥í•œë‹¤.</p>
<p>ë¨¼ì € tiingoì—ì„œ ì œê³µí•˜ëŠ” ì¢…ëª©ì€ ì–´ë– í•œ ê²ƒì´ ìˆëŠ”ì§€ í‹°ì»¤ ì •ë³´ë“¤ì„ í™•ì¸í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tickers</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_stock_tickers</span><span class="p">()</span>
<span class="n">tickers_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span>

<span class="n">tickers_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ticker</th>
      <th>exchange</th>
      <th>assetType</th>
      <th>priceCurrency</th>
      <th>startDate</th>
      <th>endDate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>000001</td>
      <td>SHE</td>
      <td>Stock</td>
      <td>CNY</td>
      <td>2007-01-04</td>
      <td>2022-08-04</td>
    </tr>
    <tr>
      <th>1</th>
      <td>000002</td>
      <td>SHE</td>
      <td>Stock</td>
      <td>CNY</td>
      <td>2007-01-04</td>
      <td>2022-08-04</td>
    </tr>
    <tr>
      <th>2</th>
      <td>000003</td>
      <td>SHE</td>
      <td>Stock</td>
      <td>CNY</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>000004</td>
      <td>SHE</td>
      <td>Stock</td>
      <td>CNY</td>
      <td>2007-08-31</td>
      <td>2022-08-04</td>
    </tr>
    <tr>
      <th>4</th>
      <td>000005</td>
      <td>SHE</td>
      <td>Stock</td>
      <td>CNY</td>
      <td>2007-08-31</td>
      <td>2022-08-04</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">list_stock_tickers()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ í‹°ì»¤ ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤. ticker(í‹°ì»¤), exchange(ê±°ë˜ì†Œ), assetType(ì£¼ì‹ ì¢…ë¥˜), priceCurrency(ê±°ë˜ í†µí™”), startDate(ì‹œì‘ì¼), endDate(ë§ˆê°ì¼) ì •ë³´ê°€ í‘œì‹œëœë‹¤. ê±°ë˜ì†Œì™€ í†µí™” ë³„ ì¢…ëª©ì´ ëª‡ê°œê°€ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tickers_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;exchange&#39;</span><span class="p">,</span> <span class="s1">&#39;priceCurrency&#39;</span><span class="p">])[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>exchange   priceCurrency
           USD               2462
AMEX       USD                 69
ASX        USD               2058
BATS       USD                  8
CSE        USD                 32
EXPM       USD               1720
LSE        USD                 13
NASDAQ     USD              12168
NYSE       USD               7669
NYSE ARCA  USD                 66
NYSE MKT   USD                384
NYSE NAT   USD                  4
OTCBB      USD                594
OTCCE      USD               1163
OTCGREY    USD               3313
OTCMKTS    USD               1203
OTCQB      USD               1366
OTCQX      USD                770
PINK       USD              14048
SHE        CNY               2401
           HKD                 53
           USD                154
SHG        CNY               1807
           USD                176
Name: ticker, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>ì´ ì¤‘ ë§ˆì´ë„ˆ ê±°ë˜ì†Œë‚˜ ì¥ì™¸ ê±°ë˜ì†Œì˜ ê²½ìš° ì •ë³´ë¥¼ ë°›ì•„ë„ ìš°ë¦¬ë‚˜ë¼ì˜ ì¦ê¶Œì‚¬ë¥¼ í†µí•´ì„œëŠ” ì‹¤ì œë¡œ ê±°ë˜ë¥¼ í•  ìˆ˜ ì—†ì„ìˆ˜ë„ ìˆë‹¤. ë”°ë¼ì„œ ì‹¤ì œ ê±°ë˜ê°€ ê°€ëŠ¥í•œ ê±°ë˜ì†Œ ë°ì´í„°ë§Œ í•„í„°ë§í•œ í›„ í•´ë‹¹ ì¢…ëª©ë“¤ì„ ë°›ëŠ” ê²ƒì´ íš¨ìœ¨ì ì´ë‹¤.</p>
<p>ê° ì¢…ëª©ì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ë„ë¡ í•˜ë©°, ì˜ˆë¡œì¨ ì• í”Œ(AAPL)ì„ ì´ìš©í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ticker_metadata</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_ticker_metadata</span><span class="p">(</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ticker_metadata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ticker&#39;: &#39;AAPL&#39;, &#39;name&#39;: &#39;Apple Inc&#39;, &#39;description&#39;: &quot;Apple Inc. (Apple) designs, manufactures and markets mobile communication and media devices, personal computers, and portable digital music players, and a variety of related software, services, peripherals, networking solutions, and third-party digital content and applications. The Company&#39;s products and services include iPhone, iPad, Mac, iPod, Apple TV, a portfolio of consumer and professional software applications, the iOS and OS X operating systems, iCloud, and a variety of accessory, service and support offerings. The Company also delivers digital content and applications through the iTunes Store, App StoreSM, iBookstoreSM, and Mac App Store. The Company distributes its products worldwide through its retail stores, online stores, and direct sales force, as well as through third-party cellular network carriers, wholesalers, retailers, and value-added resellers. In February 2012, the Company acquired app-search engine Chomp.&quot;, &#39;startDate&#39;: &#39;1980-12-12&#39;, &#39;endDate&#39;: &#39;2022-08-04&#39;, &#39;exchangeCode&#39;: &#39;NASDAQ&#39;}
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get_ticker_metadata()</span></code> ë©”ì„œë“œ ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´ í‹°ì»¤, ì¢…ëª©ëª…, ì‚¬ì—…ë‚´ì—­ ë“± ëŒ€ëµì ì¸ ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.</p>
<p>ì´ì œ ì£¼ê°€ë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">historical_prices</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
                                         <span class="n">startDate</span><span class="o">=</span><span class="s1">&#39;2017-08-01&#39;</span><span class="p">,</span>
                                         <span class="n">frequency</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">)</span>

<span class="n">historical_prices</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>open</th>
      <th>volume</th>
      <th>adjClose</th>
      <th>adjHigh</th>
      <th>adjLow</th>
      <th>adjOpen</th>
      <th>adjVolume</th>
      <th>divCash</th>
      <th>splitFactor</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-08-01 00:00:00+00:00</th>
      <td>150.05</td>
      <td>150.22</td>
      <td>148.4100</td>
      <td>149.10</td>
      <td>24725526</td>
      <td>35.505368</td>
      <td>35.545594</td>
      <td>35.117306</td>
      <td>35.280576</td>
      <td>98902104</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2017-08-02 00:00:00+00:00</th>
      <td>157.14</td>
      <td>159.75</td>
      <td>156.1600</td>
      <td>159.28</td>
      <td>69222793</td>
      <td>37.183030</td>
      <td>37.800617</td>
      <td>36.951138</td>
      <td>37.689404</td>
      <td>276891172</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2017-08-03 00:00:00+00:00</th>
      <td>155.57</td>
      <td>157.21</td>
      <td>155.0200</td>
      <td>157.05</td>
      <td>26000738</td>
      <td>36.811530</td>
      <td>37.199593</td>
      <td>36.681388</td>
      <td>37.161733</td>
      <td>104002952</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2017-08-04 00:00:00+00:00</th>
      <td>156.39</td>
      <td>157.40</td>
      <td>155.6900</td>
      <td>156.07</td>
      <td>20349532</td>
      <td>37.005562</td>
      <td>37.244552</td>
      <td>36.839925</td>
      <td>36.929842</td>
      <td>81398128</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2017-08-07 00:00:00+00:00</th>
      <td>158.81</td>
      <td>158.92</td>
      <td>156.6701</td>
      <td>157.06</td>
      <td>21870321</td>
      <td>37.578191</td>
      <td>37.604219</td>
      <td>37.071840</td>
      <td>37.164100</td>
      <td>87481284</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get_dataframe()</span></code> ë©”ì„œë“œ ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´ close(ì¢…ê°€), high(ê³ ê°€), low(ì €ê°€), open(ì‹œê°€), volumne(ê±°ë˜ëŸ‰) ë° ìˆ˜ì •ì£¼ê°€ì™€ divCash(í˜„ê¸ˆ ë°°ë‹¹), splitFactor(ì£¼ì‹ë¶„í•  ì¡°ì •ê³„ìˆ˜)ê¹Œì§€ ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.</p>
<p>ì´ë²ˆì—ëŠ” ì¼ë³„ ê°€ì¹˜ì§€í‘œë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ì. (ë¬´ë£Œ ê³„ì •ì˜ ê²½ìš° ë‹¤ìš°ì¡´ìŠ¤ 30 ì§€ìˆ˜ì— í¬í•¨ë˜ëŠ” ì¢…ëª© ì •ë³´ë§Œ ì œê³µí•œë‹¤.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fundamentals_daily</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_fundamentals_daily</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">)</span>
<span class="n">fundamentals_daily_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">fundamentals_daily</span><span class="p">)</span>

<span class="n">fundamentals_daily_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>marketCap</th>
      <th>enterpriseVal</th>
      <th>peRatio</th>
      <th>pbRatio</th>
      <th>trailingPEG1Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-08-05T00:00:00.000Z</td>
      <td>8.737383e+11</td>
      <td>9.316263e+11</td>
      <td>16.357022</td>
      <td>9.222566</td>
      <td>-2.412661</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-08-06T00:00:00.000Z</td>
      <td>8.902785e+11</td>
      <td>9.481665e+11</td>
      <td>16.666667</td>
      <td>9.397153</td>
      <td>-2.458333</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-08-07T00:00:00.000Z</td>
      <td>8.994976e+11</td>
      <td>9.573856e+11</td>
      <td>16.839255</td>
      <td>9.494463</td>
      <td>-2.483790</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-08-08T00:00:00.000Z</td>
      <td>9.193368e+11</td>
      <td>9.772248e+11</td>
      <td>17.210660</td>
      <td>9.703872</td>
      <td>-2.538572</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-08-09T00:00:00.000Z</td>
      <td>9.083100e+11</td>
      <td>9.661980e+11</td>
      <td>17.004230</td>
      <td>9.587481</td>
      <td>-2.508124</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get_fundamentals_daily()</span></code> ë©”ì„œë“œ ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´ ì¼ê°„ ì‹œê°€ì´ì•¡, ê¸°ì—…ê°€ì¹˜, PER, PBR, PEG ì •ë³´ê°€ JSON í˜•íƒœë¡œ ë°›ì•„ì§€ë©°, <code class="docutils literal notranslate"><span class="pre">from_records()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ ë°ì´í„°í”„ë ˆì„ í˜•íƒœë¡œ ë³€ê²½í•´ì¤€ë‹¤.</p>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì¬ë¬´ì œí‘œë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fundamentals_stmnts</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_fundamentals_statements</span><span class="p">(</span>
    <span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="n">startDate</span><span class="o">=</span><span class="s1">&#39;2019-01-01&#39;</span><span class="p">,</span> <span class="n">asReported</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">)</span>

<span class="n">df_fs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fundamentals_stmnts</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)])</span>
<span class="n">df_fs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_fs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df_fs</span> <span class="o">=</span> <span class="n">df_fs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">df_fs</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_fs</span> <span class="o">=</span> <span class="n">df_fs</span><span class="p">[</span><span class="n">df_fs</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>

<span class="n">df_fs</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>quarter</th>
      <th>statementType</th>
      <th>dataCode</th>
      <th>value</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-07-29</th>
      <td>2022</td>
      <td>3</td>
      <td>cashFlow</td>
      <td>ncff</td>
      <td>-27445000000.0</td>
    </tr>
    <tr>
      <th>2022-07-29</th>
      <td>2022</td>
      <td>3</td>
      <td>balanceSheet</td>
      <td>liabilitiesCurrent</td>
      <td>129873000000.0</td>
    </tr>
    <tr>
      <th>2022-07-29</th>
      <td>2022</td>
      <td>3</td>
      <td>balanceSheet</td>
      <td>deferredRev</td>
      <td>7728000000.0</td>
    </tr>
    <tr>
      <th>2022-07-29</th>
      <td>2022</td>
      <td>3</td>
      <td>cashFlow</td>
      <td>ncfi</td>
      <td>4234000000.0</td>
    </tr>
    <tr>
      <th>2022-07-29</th>
      <td>2022</td>
      <td>3</td>
      <td>incomeStatement</td>
      <td>netinc</td>
      <td>19442000000.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_fundamentals_statements()</span></code> ë©”ì„œë“œ ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´ ì¬ë¬´ì œí‘œì˜ ì„¸ë¶€í•­ëª©ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. ë˜í•œ <code class="docutils literal notranslate"><span class="pre">fmt</span></code>ì€ í¬ë§· í˜•íƒœë¥¼ ì˜ë¯¸í•˜ë©°, JSONìœ¼ë¡œ ë°›ì„ ê²½ìš° í˜•íƒœê°€ ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•˜ë¯€ë¡œ CSVë¡œ ë°›ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p></li>
<li><p>í…ìŠ¤íŠ¸ í˜•íƒœë¡œ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ë¯€ë¡œ, í´ë Œì§•ì„ í†µí•´ ë°ì´í„°í”„ë ˆì„ í˜•íƒœë¡œ ë³€ê²½í•œë‹¤.</p></li>
<li><p>ì²«ë²ˆì§¸ í–‰ì„ ì—´ ì´ë¦„ìœ¼ë¡œ ì§€ì •í•œ í›„, í•´ë‹¹ í–‰ì€ ì‚­ì œí•œë‹¤.</p></li>
<li><p>â€˜dateâ€™ ì—´ì„ ì¸ë±ìŠ¤ë¡œ ì§€ì •í•œë‹¤.</p></li>
<li><p>â€˜dateâ€™ê°€ ë¹„ì–´ìˆëŠ” ë¶€ë¶„ì´ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì œê±°í•œë‹¤.</p></li>
</ol>
<p>ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ë©´ ì—°ê°„ ì¬ë¬´ì œí‘œì™€ ë¶„ê¸° ì¬ë¬´ì œí‘œì˜ ìƒì„¸ ì •ë³´ê°€ ë‹¤ìš´ë¡œë“œ ë  ë¿ë§Œ ì•„ë‹ˆë¼ ë°œí‘œ ë‚ ì§œ ë˜í•œ ì œê³µëœë‹¤. ì´ì²˜ëŸ¼ ìœ ë£Œ ë²¤ë”ë¥¼ ì´ìš©í•˜ë©´ í‹°ì»¤ ë° ì£¼ê°€, ì¬ë¬´ì œí‘œ, ê°€ì¹˜ì§€í‘œë¥¼ ë§¤ìš° ì‰½ê³  ë¹ ë¥´ê²Œ ë°›ì„ ìˆ˜ ìˆë‹¤.</p>
<p>tiingoì˜ API ì‚¬ìš©ë²• ë° íŒŒì´ì¬ íŒ¨í‚¤ì§€ ì‚¬ìš©ë²•ì€ ì•„ë˜ í˜ì´ì§€ì— ë‚˜ì™€ìˆë‹¤.</p>
<ul class="simple">
<li><p>tiingo API: <a class="reference external" href="https://api.tiingo.com/documentation/general/overview">https://api.tiingo.com/documentation/general/overview</a></p></li>
<li><p>íŒŒì´ì¬ íŒ¨í‚¤ì§€: <a class="reference external" href="https://github.com/hydrosquall/tiingo-python">https://github.com/hydrosquall/tiingo-python</a></p></li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h2><span class="section-number">11.2. </span>í‹°ì»¤ ìˆ˜ì§‘í•˜ê¸°<a class="headerlink" href="#id4" title="Permalink to this headline">Â¶</a></h2>
<p>ì´ë²ˆì—ëŠ” í¬ë¡¤ë§ì„ í†µí•´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ë‹¤. ìš°ë¦¬ë‚˜ë¼ëŠ” í•œêµ­ê±°ë˜ì†Œë¥¼ í†µí•´ í‹°ì»¤ë¥¼ ì†ì‰½ê²Œ ìˆ˜ì§‘í•  ìˆ˜ ìˆì§€ë§Œ í•´ì™¸ì˜ ê²½ìš°ëŠ” ê·¸ë ‡ì§€ ì•Šë‹¤. ë¨¼ì € ìš°ë¦¬ë‚˜ë¼ì™€ ë‹¬ë¦¬ êµ­ê°€ ë³„ë¡œ ê±°ë˜ì†Œê°€ ì—¬ëŸ¬ê°œì¸ ê²½ìš°ë„ ìˆìœ¼ë©°, í™ˆí˜ì´ì§€ì— ìƒì¥ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ” ê²½ìš°ë„ ë§ê¸° ë•Œë¬¸ì´ë‹¤.</p>
<p>ë‹¤í–‰íˆ íˆ¬ììë“¤ì´ ë§ì´ ì°¸ì¡°í•˜ëŠ” ì‚¬ì´íŠ¸ì¸ ì¸ë² ìŠ¤íŒ…ë‹·ì»´(<a class="reference external" href="https://www.investing.com/">https://www.investing.com/</a>)ì—ì„œëŠ” ì „ ì„¸ê³„ ì£¼ì‹ ë° ê°ì¢… ê¸ˆìœµ ë°ì´í„°ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. ì´ ì¤‘ ìŠ¤í¬ë¦¬ë‹ ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ ê° êµ­ê°€ë³„ í‹°ì»¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤. ë¨¼ì € ì¸ë² ìŠ¤íŒ…ë‹·ì»´ì— ì ‘ì†í•œ í›„ [Markets â†’ Stocks â†’ Stock Screener]ì— ì ‘ì†í•œë‹¤.</p>
<div class="figure align-default" id="screen">
<img alt="_images/screen.png" src="_images/screen.png" />
<p class="caption"><span class="caption-number">Fig. 11.3 </span><span class="caption-text">ì¸ë² ìŠ¤íŒ…ë‹·ì»´ì˜ ì£¼ì‹ ìŠ¤í¬ë¦¬ë„ˆ</span><a class="headerlink" href="#screen" title="Permalink to this image">Â¶</a></p>
</div>
<p>í˜ì´ì§€ë¥¼ ì ‘ì†í•˜ë©´ ë¯¸êµ­ ì¢…ëª©ë“¤ì´ ë‚˜íƒ€ë‚˜ë©°, URLì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://www.investing.com/stock-screener/?sp=country::5|sector::a|industry::a|equityType::a%3Ceq_market_cap;1
</pre></div>
</div>
<p>í•˜ë‹¨ì— í‘œë¡œ ë‚˜íƒ€ëŠ” ì •ë³´ ì¤‘ Symbolì´ í‹°ì»¤ì— í•´ë‹¹í•˜ë©°, ì´ë¥¼ í†µí•´ í‹°ì»¤ë¥¼ ì†ì‰½ê²Œ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤. ë‹¤ìŒìœ¼ë¡œ êµ­ê°€ë¥¼ Japan(ì¼ë³¸)ìœ¼ë¡œ ì„ íƒí•˜ê³ , Equity Typeì€ ORD(ë³´í†µì£¼)ë¥¼ ì„ íƒí•˜ì.</p>
<div class="figure align-default" id="japan">
<img alt="_images/japan.png" src="_images/japan.png" />
<p class="caption"><span class="caption-number">Fig. 11.4 </span><span class="caption-text">ì¼ë³¸ êµ­ê°€ ì„ íƒ</span><a class="headerlink" href="#japan" title="Permalink to this image">Â¶</a></p>
</div>
<p>í•˜ë‹¨ì˜ í…Œì´ë¸”ì´ ì¼ë³¸ ì¢…ëª©ë“¤ë¡œ ë°”ë€Œë©° URL ì—­ì‹œ ë‹¤ìŒê³¼ ê°™ì´ ë°”ë€ë‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://www.investing.com/stock-screener/?sp=country::35|sector::a|industry::a|equityType::ORD%3Ceq_market_cap;1
</pre></div>
</div>
<p>ì¦‰ ê¸°ì¡´ URL ì¤‘ êµ­ê°€ì— í•´ë‹¹í•˜ëŠ” â€˜countryâ€™ ë¶€ë¶„ì´ 5ì—ì„œ 35ë¡œ, ì£¼ì‹ ì¢…ë¥˜ì— í•´ë‹¹í•˜ëŠ” â€˜equityTypeâ€™ ë¶€ë¶„ì´ aì—ì„œ ORDë¡œ ë³€ê²½ë˜ì—ˆë‹¤. í•´ë‹¹ í˜ì´ì§€ëŠ” ë™ì ìœ¼ë¡œ í˜ì´ì§€ê°€ ë°”ë€Œë¯€ë¡œ ì…€ë ˆë‹ˆì›€ì„ í†µí•´ í¬ë¡¤ë§ì„ í•´ì•¼í•œë‹¤. ì˜ˆì œë¡œ ë¯¸êµ­ì˜ ë³´í†µì£¼ ì „ì¢…ëª© ì •ë³´ë¥¼ í¬ë¡¤ë§ í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">webdriver_manager.chrome</span> <span class="kn">import</span> <span class="n">ChromeDriverManager</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">Service</span><span class="p">(</span><span class="n">ChromeDriverManager</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">()))</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.investing.com/stock-screener/?sp=country::5|sector::a|industry::a|equityType::ORD%3Ceq_market_cap;1&#39;</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>ë¨¼ì € í¬ë¡¬ ë“œë¼ì´ë²„ë¥¼ ì„¤ì •í•œë‹¤.</p></li>
<li><p>ë¯¸êµ­ ë³´í†µì£¼ì— í•´ë‹¹í•˜ëŠ” URLì„ ì…ë ¥í•œë‹¤.</p></li>
<li><p>í•´ë‹¹ í˜ì´ì§€ë¥¼ ì—°ë‹¤.</p></li>
</ol>
<div class="figure align-default" id="selenium-open">
<img alt="_images/selenium_open.png" src="_images/selenium_open.png" />
<p class="caption"><span class="caption-number">Fig. 11.5 </span><span class="caption-text">ì…€ë ˆë‹ˆì›€ì„ ì´ìš©í•œ ìŠ¤í¬ë¦¬ë„ˆ ì ‘ì†</span><a class="headerlink" href="#selenium-open" title="Permalink to this image">Â¶</a></p>
</div>
<p>ë‹¤ìŒìœ¼ë¡œ HTML ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">html</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>HTML ì •ë³´ì— í•´ë‹¹í•˜ëŠ” <code class="docutils literal notranslate"><span class="pre">driver.page_source</span></code>ë¥¼ BeautifulSoup ê°ì²´ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤. ì´ì œ ìš°ë¦¬ê°€ ì°¾ê³ ì í•˜ëŠ” ë°ì´í„°ë¥¼ í•˜ë‚˜ì”© ì‚´í´ë³´ë„ë¡ í•œë‹¤. ë¨¼ì € ê° êµ­ê°€ë³„ ì½”ë“œë¥¼ ì‚´í´ë³´ë„ë¡ í•˜ì. ê°œë°œìë„êµ¬ í™”ë©´ì—ì„œ â€˜newBtnDropdown noHoverâ€™ í´ë˜ìŠ¤ í•˜ë‹¨ì˜ â€˜li íƒœê·¸ì˜ â€˜data-valueâ€™ ì†ì„±ì„ ì‚´í´ë³´ë©´ êµ­ê°€ë³„ ì½”ë“œì™€ êµ­ê°€ëª…ì´ ì í˜€ìˆë‹¤.</p>
<div class="figure align-default" id="country-ticker">
<img alt="_images/country_ticker.png" src="_images/country_ticker.png" />
<p class="caption"><span class="caption-number">Fig. 11.6 </span><span class="caption-text">êµ­ê°€ë³„ ì½”ë“œ</span><a class="headerlink" href="#country-ticker" title="Permalink to this image">Â¶</a></p>
</div>
<p>ì´ë²ˆì—ëŠ” ìœ„ì ¯ì—ì„œ ì„ íƒë˜ì–´ ìˆëŠ” êµ­ê°€ëª…ì„ í™•ì¸í•´ë³´ë„ë¡ í•˜ì. â€˜newBtnDropdown noHoverâ€™ í´ë˜ìŠ¤ í•˜ë‹¨ì˜ â€˜inputâ€™ íƒœê·¸ì˜ â€˜valueâ€™ ì†ì„±ì˜ ì†ì„±ëª…ì—ëŠ” êµ­ê°€ëª…ì´ ì í˜€ ìˆë‹¤. ì´ë¥¼ ì½”ë“œë¥¼ í†µí•´ ì°¾ì•„ë³´ë„ë¡ í•˜ì.</p>
<div class="figure align-default" id="country-name">
<img alt="_images/country_name.png" src="_images/country_name.png" />
<p class="caption"><span class="caption-number">Fig. 11.7 </span><span class="caption-text">êµ­ê°€ëª… í™•ì¸</span><a class="headerlink" href="#country-name" title="Permalink to this image">Â¶</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;js-search-input inputDropDown&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;United States&#39;
</pre></div>
</div>
</div>
</div>
<p>ì´ë²ˆì—ëŠ” ì¢…ëª©ë“¤ì˜ ì •ë³´ê°€ ìˆëŠ” í…Œì´ë¸”ì„ í™•ì¸í•´ë³´ë„ë¡ í•˜ì. í´ë˜ìŠ¤ ëª…ì´ â€˜genTbl openTbl resultsStockScreenerTbl elpTblâ€™ ì¸ í…Œì´ë¸” ì¤‘ â€˜tbodyâ€™ ë¶€ë¶„ì— í•´ë‹¹ ë°ì´í„°ê°€ ìœ„ì¹˜í•˜ê³  ìˆë‹¤. ì´ ì •ë³´ë¥¼ ì´ìš©í•´ í•´ë‹¹ í…Œì´ë¸” ë°ì´í„°ë¥¼ ì„ íƒí•˜ì.</p>
<div class="figure align-default" id="screen-table">
<img alt="_images/screen_table.png" src="_images/screen_table.png" />
<p class="caption"><span class="caption-number">Fig. 11.8 </span><span class="caption-text">ì¢…ëª© í…Œì´ë¸”</span><a class="headerlink" href="#screen-table" title="Permalink to this image">Â¶</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">html_table</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;table.genTbl.openTbl.resultsStockScreenerTbl.elpTbl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">html_table</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="selenium-1">
<img alt="_images/selenium_1.png" src="_images/selenium_1.png" />
</div>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ table íƒœê·¸ ì¤‘ í•´ë‹¹ í´ë˜ìŠ¤ëª…ì„ ì°¾ì€ í›„ ì¶œë ¥í•˜ë©´, ì¢…ëª© ì •ë³´ë“¤ì´ ë‹´ê¸´ í…Œì´ë¸”ì˜ HTML ì •ë³´ê°€ ì¶œë ¥ëœë‹¤. ì´ì œ ì´ë¥¼ ë°ì´í„°í”„ë ˆì„ í˜•íƒœë¡œ ë³€í™˜í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">html_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
<span class="n">df_table_result</span> <span class="o">=</span> <span class="n">df_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">prettify()</span></code> ë©”ì„œë“œë¥¼ ì´ìš©í•´ BeautifulSoup ì—ì„œ íŒŒì‹±í•œ íŒŒì„œ íŠ¸ë¦¬ë¥¼ ìœ ë‹ˆì½”ë“œ í˜•íƒœë¡œ ë‹¤ì‹œ ëŒë ¤ì¤€ í›„, <code class="docutils literal notranslate"><span class="pre">read_html()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ í…Œì´ë¸”ì„ ì½ì–´ì˜¨ë‹¤. Variable Explorer ì°½ì—ì„œ df_table_result ë³€ìˆ˜ë¥¼ í™•ì¸í•´ë³´ì.</p>
<div class="figure align-default" id="selenium-2">
<img alt="_images/selenium_2.png" src="_images/selenium_2.png" />
<p class="caption"><span class="caption-number">Fig. 11.9 </span><span class="caption-text">í¬ë¡¤ë§ ê²°ê³¼ í™•ì¸</span><a class="headerlink" href="#selenium-2" title="Permalink to this image">Â¶</a></p>
</div>
<p>ê²°ê³¼ë¥¼ ì‚´í´ë³´ë©´ ì›¹í˜ì´ì§€ì— ìˆëŠ” ë‚´ì—­ ì™¸ì—ë„ Exchange(ê±°ë˜ì†Œ), Sector, Industy ë“± ì¶”ê°€ì ì¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì´ ì¤‘ í•„ìš”í•œ ì—´ë§Œ ì„ íƒí•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_table_select</span> <span class="o">=</span> <span class="n">df_table</span><span class="p">[</span><span class="mi">0</span><span class="p">][[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Exchange&#39;</span><span class="p">,</span>  <span class="s1">&#39;Sector&#39;</span><span class="p">,</span> <span class="s1">&#39;Market Cap&#39;</span><span class="p">]]</span>
<span class="n">df_table_select</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Symbol</th>
      <th>Exchange</th>
      <th>Sector</th>
      <th>Market Cap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Apple</td>
      <td>AAPL</td>
      <td>NASDAQ</td>
      <td>Information Technology</td>
      <td>2.66T</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Microsoft</td>
      <td>MSFT</td>
      <td>NASDAQ</td>
      <td>Information Technology</td>
      <td>2.12T</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alphabet A</td>
      <td>GOOGL</td>
      <td>NASDAQ</td>
      <td>Communication Services</td>
      <td>1.55T</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alphabet C</td>
      <td>GOOG</td>
      <td>NASDAQ</td>
      <td>Communication Services</td>
      <td>1.52T</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Amazon.com</td>
      <td>AMZN</td>
      <td>NASDAQ</td>
      <td>Consumer Discretionary</td>
      <td>1.45T</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì¢…ëª© ì •ë³´ê°€ ëª‡í˜ì´ì§€ê¹Œì§€ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤. ì›¹í˜ì´ì§€ì˜ â€˜Screener Resultsâ€™ ê¸€ì ë’¤ì—ëŠ” í•´ë‹¹ êµ­ê°€ì— ì´ ëª‡ ì¢…ëª©ì´ ìˆëŠ”ì§€ ì¶œë ¥ëœë‹¤. í•œ í˜ì´ì§€ì—ëŠ” ì´ 50 ì¢…ëª©ì´ ì¶œë ¥ë˜ë¯€ë¡œ í•´ë‹¹ ìˆ«ìë¥¼ 50ìœ¼ë¡œ ë‚˜ëˆˆ í›„ ì˜¬ë¦¼ì„ í•˜ë©´ ì´ í˜ì´ì§€ ìˆ˜ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤. í•´ë‹¹ ì •ë³´ëŠ” â€˜js-total-resultsâ€™ í´ë˜ìŠ¤ì— ìœ„ì¹˜í•˜ê³  ìˆìœ¼ë©°, ì´ë¥¼ ì´ìš©í•´ í˜ì´ì§€ ìˆ˜ë¥¼ ê³„ì‚°í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="figure align-default" id="country-page">
<img alt="_images/country_page.png" src="_images/country_page.png" />
<p class="caption"><span class="caption-number">Fig. 11.10 </span><span class="caption-text">ì¢…ëª© ìˆ˜ í™•ì¸</span><a class="headerlink" href="#country-page" title="Permalink to this image">Â¶</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">end_num</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;js-total-results&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="nb">print</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">end_num</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>185
</pre></div>
</div>
</div>
</div>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ë“œë¼ì´ë¸Œë¡¤ ì¢…ë£Œí•´ì¤€ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h3><span class="section-number">11.2.1. </span>ì „ ì¢…ëª© í‹°ì»¤ í¬ë¡¤ë§<a class="headerlink" href="#id5" title="Permalink to this headline">Â¶</a></h3>
<p>ìœ„ ê³¼ì •ì„ í†µí•´ êµ­ê°€ë³„ ì „ ì¢…ëª©ì˜ í‹°ì»¤ ë° ê´€ë ¨ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ê³¼, í˜ì´ì§€ ìˆ˜ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆì—ˆë‹¤. ì´ì œ forë¬¸ì„ ì´ìš©í•´ ë¯¸êµ­ì˜ ì „ ì¢…ëª© í‹°ì»¤ë¥¼ í¬ë¡¤ë§í•´ë³´ë„ë¡ í•˜ê² ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">webdriver_manager.chrome</span> <span class="kn">import</span> <span class="n">ChromeDriverManager</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">Service</span><span class="p">(</span><span class="n">ChromeDriverManager</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">()))</span>
<span class="n">nationcode</span> <span class="o">=</span> <span class="s1">&#39;5&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;https://investing.com/stock-screener/?sp=country::</span>
<span class="si">{</span><span class="n">nationcode</span><span class="si">}</span><span class="s1">|sector::a|industry::a|equityType::ORD%3Ceq_market_cap;1&#39;&#39;&#39;</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">(</span>
    <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;resultsTable&quot;]/tbody&#39;</span><span class="p">)))</span>

<span class="n">end_num</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;js-total-results&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="n">end_num</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">end_num</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>í¬ë¡¬ ë“œë¼ì´ë¸Œë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.</p></li>
<li><p>êµ­ê°€ ì½”ë“œëŠ” ë¯¸êµ­ì— í•´ë‹¹í•˜ëŠ” â€˜5â€™ë¥¼ ì…ë ¥í•œë‹¤.</p></li>
<li><p>ë¨¼ì € ì²«í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” URLì„ ìƒì„±í•œë‹¤.</p></li>
<li><p>ì…€ë ˆë‹ˆì›€ìœ¼ë¡œ í•´ë‹¹ í˜ì´ì§€ë¥¼ ì—°ë‹¤</p></li>
<li><p>â€˜Screener Resultsâ€™ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì€ ì¢…ëª©ì´ ë“¤ì–´ìˆëŠ” í…Œì´ë¸”ì´ ë¡œë”©ëœ ì´í›„ ë‚˜íƒ€ë‚œë‹¤. ë”°ë¼ì„œ <code class="docutils literal notranslate"><span class="pre">WebDriverWait()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ í•´ë‹¹ í…Œì´ë¸”ì´ ë¡œë”©ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë©°, í…Œì´ë¸”ì˜ XPATHëŠ” â€˜//*[&#64;id=â€resultsTableâ€]/tbodyâ€™ ì´ë‹¤.</p></li>
<li><p>ì¢…ëª©ìˆ˜ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ í¬ë¡¤ë§í•œ í›„, ì´ë¥¼ í†µí•´ í˜ì´ì§€ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤.</p></li>
</ol>
<p>ì´ì œ forë¬¸ì„ í†µí•´ ëª¨ë“  í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ í¬ë¡¤ë§í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_data_df</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>

    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;https://investing.com/stock-screener/?sp=country::</span>
<span class="s1">        </span><span class="si">{</span><span class="n">nationcode</span><span class="si">}</span><span class="s1">|sector::a|industry::a|equityType::ORD%3Ceq_market_cap;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;&#39;&#39;</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">(</span>
            <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;resultsTable&quot;]/tbody&#39;</span><span class="p">)))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">(</span>
            <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;resultsTable&quot;]/tbody&#39;</span><span class="p">)))</span>

    <span class="n">html</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>

    <span class="n">html_table</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s1">&#39;table.genTbl.openTbl.resultsStockScreenerTbl.elpTbl&#39;</span><span class="p">)</span>
    <span class="n">df_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">html_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">df_table_select</span> <span class="o">=</span> <span class="n">df_table</span><span class="p">[</span><span class="mi">0</span><span class="p">][[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Symbol&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Exchange&#39;</span><span class="p">,</span>  <span class="s1">&#39;Sector&#39;</span><span class="p">,</span> <span class="s1">&#39;Market Cap&#39;</span><span class="p">]]</span>

    <span class="n">all_data_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_table_select</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_data_df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">data_country</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;js-search-input inputDropDown&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="n">all_data_df_bind</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_country</span>
<span class="n">all_data_df_bind</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="p">[</span><span class="o">~</span><span class="n">all_data_df_bind</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="p">[</span><span class="n">all_data_df_bind</span><span class="p">[</span><span class="s1">&#39;Exchange&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;NASDAQ&#39;</span><span class="p">,</span> <span class="s1">&#39;NYSE&#39;</span><span class="p">,</span> <span class="s1">&#39;NYSE Amex&#39;</span><span class="p">])]</span>
<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;Symbol&#39;</span><span class="p">])</span>
<span class="n">all_data_df_bind</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

<span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>ë¹ˆ ë¦¬ìŠ¤íŠ¸(all_data_df)ë¥¼ ìƒì„±í•œë‹¤.</p></li>
<li><p>forë¬¸ì„ í†µí•´ ì „ì²´ í˜ì´ì§€ì—ì„œ ì¢…ëª©ëª…ê³¼ í‹°ì»¤ ë“±ì˜ ì •ë³´ë¥¼ í¬ë¡¤ë§í•œë‹¤.</p></li>
<li><p>f-stringì„ í†µí•´ ê° í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” URLì„ ìƒì„±í•œ í›„ í˜ì´ì§€ë¥¼ ì—°ë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WebDriverWait()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ í…Œì´ë¸”ì´ ë¡œë”©ë ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. ë˜í•œ ê°„í˜¹ í˜ì´ì§€ ì˜¤ë¥˜ê°€ ë°œìƒí•  ë•Œê°€ ìˆìœ¼ë¯€ë¡œ, try exceptë¬¸ì„ ì´ìš©í•´ ì˜¤ë¥˜ ë°œìƒ ì‹œ 1ì´ˆê°„ ê¸°ë‹¤ë¦° í›„ <code class="docutils literal notranslate"><span class="pre">refresh()</span></code>ë¥¼ í†µí•´ ìƒˆë¡œê³ ì¹¨ì„ í•˜ì—¬ ë‹¤ì‹œ í…Œì´ë¸”ì´ ë¡œë”©ë˜ê¸¸ ê¸°ë‹¤ë¦°ë‹¤.</p></li>
<li><p>HTML ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¨ í›„, í…Œì´ë¸”ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ ì„ íƒí•œë‹¤.</p></li>
<li><p>ì›í•˜ëŠ” ì—´ë§Œ ì„ íƒí•œë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">append()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ í•´ë‹¹ í…Œì´ë¸”ì„ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•œë‹¤.</p></li>
<li><p>2ì´ˆê°€ ì¼ì‹œì •ì§€ë¥¼ í•œë‹¤.</p></li>
<li><p>forë¬¸ì´ ëë‚˜ë©´ <code class="docutils literal notranslate"><span class="pre">concat()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ ë¦¬ìŠ¤íŠ¸ ë‚´ ëª¨ë“  ë°ì´í„°í”„ë ˆì„ì„ í–‰ìœ¼ë¡œ ë¬¶ì–´ì¤€ë‹¤.</p></li>
<li><p>êµ­ê°€ëª…ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ ì¶”ì¶œí•œ ë’¤, â€˜countryâ€™ ì—´ì— ì…ë ¥í•œë‹¤.</p></li>
<li><p>â€˜dateâ€™ ì—´ì— ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ì…ë ¥í•œë‹¤.</p></li>
<li><p>ì¼ë¶€ ì¢…ëª©ì˜ ê²½ìš° ì¢…ëª©ëª…ì´ ë¹ˆì¹¸ìœ¼ë¡œ ë“¤ì–´ì˜¤ë¯€ë¡œ ì´ë¥¼ ì œê±°í•œë‹¤.</p></li>
<li><p>â€˜Exchangeâ€™ ì—´ì—ì„œ ê±°ë˜ê°€ ê°€ëŠ¥í•œ ê±°ë˜ì†Œë§Œ ì„ íƒí•œë‹¤.</p></li>
<li><p>ì¼ë¶€ ì¢…ëª©ì˜ ê²½ìš° ì¤‘ë³µëœ ê²°ê³¼ê°€ ë“¤ì–´ì˜¤ê¸°ë„ í•˜ë¯€ë¡œ <code class="docutils literal notranslate"><span class="pre">drop_duplicates()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ Symbolì´ ê²¹ì¹˜ëŠ” ê²½ìš° í•œê°œë§Œ ë‚¨ê²¨ì¤€ë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reset_index()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ ì¸ë±ìŠ¤ë¥¼ ì´ˆê¸°í™”í•œë‹¤.</p></li>
<li><p>nanì„ Noneìœ¼ë¡œ ë³€ê²½í•œë‹¤.</p></li>
<li><p>ë“œë¼ì´ë¸Œë¡¤ ì¢…ë£Œí•œë‹¤.</p></li>
</ol>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ìœ„ ë°ì´í„°í”„ë ˆì„ì„ SQLì— ì €ì¥í•´ì£¼ë„ë¡ í•œë‹¤. ë¨¼ì € SQLì—ì„œ ë‹¤ìŒì˜ ì¿¼ë¦¬ë¥¼ í†µí•´ í…Œì´ë¸”(global_ticker)ì„ ë§Œë“ ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>use stock_db;

create table global_ticker
(
    Name varchar(50) not null,
    Symbol varchar(30),
    Exchange varchar(30),
    Sector varchar(30),
    `Market Cap` varchar(10),
    country varchar(20),    
    date date,
    primary key(Symbol, country, date)
);
</pre></div>
</div>
</div>
</div>
<p>ìœ„ì—ì„œ êµ¬í•œ í‹°ì»¤ ë°ì´í„°ë¥¼ í•´ë‹¹ í…Œì´ë¸”ì— ì €ì¥í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymysql</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                      <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span>
                      <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                      <span class="n">db</span><span class="o">=</span><span class="s1">&#39;stock_db&#39;</span><span class="p">,</span>
                      <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>

<span class="n">mycursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    insert into global_ticker (Name, Symbol, Exchange, Sector, `Market Cap`, country, date)</span>
<span class="s2">    values (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">) as new</span>
<span class="s2">    on duplicate key update</span>
<span class="s2">    name=new.name,Exchange=new.Exchange,Sector=new.Sector,</span>
<span class="s2">    `Market Cap`=new.`Market Cap`; </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">mycursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="ticker-sql">
<img alt="_images/ticker_sql.png" src="_images/ticker_sql.png" />
<p class="caption"><span class="caption-number">Fig. 11.11 </span><span class="caption-text">ê¸€ë¡œë²Œ í‹°ì»¤ í…Œì´ë¸”</span><a class="headerlink" href="#ticker-sql" title="Permalink to this image">Â¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>nationcode ë¶€ë¶„ë§Œ ë³€ê²½í•˜ë©´ ëª¨ë“  êµ­ê°€ì˜ í‹°ì»¤ ë¦¬ìŠ¤íŠ¸ ì—­ì‹œ ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆë‹¤.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="id6">
<h2><span class="section-number">11.3. </span>ì£¼ê°€ ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id6" title="Permalink to this headline">Â¶</a></h2>
<p>ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œëŠ” ì „ ì„¸ê³„ ì£¼ê°€(í•œêµ­ í¬í•¨)ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">finance</span><span class="o">.</span><span class="n">yahoo</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
</pre></div>
</div>
<p>ì‚¬ì´íŠ¸ì—ì„œ ì¢…ëª© í‹°ì»¤ë¥¼ ê²€ìƒ‰í•œ í›„ [Historical Data] íƒ­ì„ ì„ íƒí•˜ë©´ í™•ì¸ ë° ë‹¤ìš´ë¡œë“œê°€ ê°€ëŠ¥í•˜ë‹¤. ë˜í•œ pandas_datareader íŒ¨í‚¤ì§€ì˜ <code class="docutils literal notranslate"><span class="pre">DataReader()</span></code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì•¼í›„ APIë¥¼ í†µí•´ í•´ë‹¹ ë°ì´í„°ë¥¼ ë§¤ìš° ì†ì‰½ê²Œ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ë„ ìˆë‹¤. ì˜ˆì‹œë¡œì¨ ì• í”Œ(AAPL)ì˜ ì£¼ê°€ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ì•„ë³´ë„ë¡ í•˜ì.</p>
<div class="figure align-default" id="yahoo-price">
<img alt="_images/yahoo_price.png" src="_images/yahoo_price.png" />
<p class="caption"><span class="caption-number">Fig. 11.12 </span><span class="caption-text">ì•¼í›„ì—ì„œ ì œê³µí•˜ëŠ” ì£¼ê°€ ë°ì´í„°</span><a class="headerlink" href="#yahoo-price" title="Permalink to this image">Â¶</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas_datareader</span> <span class="k">as</span> <span class="nn">web</span>

<span class="n">price</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;yahoo&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Adj Close</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-08-07</th>
      <td>39.730000</td>
      <td>39.167500</td>
      <td>39.264999</td>
      <td>39.702499</td>
      <td>87481200.0</td>
      <td>37.585022</td>
    </tr>
    <tr>
      <th>2017-08-08</th>
      <td>40.457500</td>
      <td>39.567501</td>
      <td>39.650002</td>
      <td>40.020000</td>
      <td>144823600.0</td>
      <td>37.885582</td>
    </tr>
    <tr>
      <th>2017-08-09</th>
      <td>40.317501</td>
      <td>39.777500</td>
      <td>39.814999</td>
      <td>40.264999</td>
      <td>104526000.0</td>
      <td>38.117508</td>
    </tr>
    <tr>
      <th>2017-08-10</th>
      <td>40.000000</td>
      <td>38.657501</td>
      <td>39.974998</td>
      <td>38.830002</td>
      <td>163217200.0</td>
      <td>36.903397</td>
    </tr>
    <tr>
      <th>2017-08-11</th>
      <td>39.642502</td>
      <td>39.017502</td>
      <td>39.150002</td>
      <td>39.369999</td>
      <td>105028400.0</td>
      <td>37.416603</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataReader()</span></code> í•¨ìˆ˜ ë‚´ì— í‹°ì»¤ì™€ ì¶œì²˜ì— í•´ë‹¹í•˜ëŠ” â€˜yahooâ€™ë¥¼ ì…ë ¥í•˜ë©´ ì£¼ê°€ ì •ë³´ë¥¼ ë§¤ìš° ì†ì‰½ê²Œ ë°›ì„ ìˆ˜ ìˆë‹¤.</p>
<p>ë°˜ë©´ ë¯¸êµ­ì´ ì•„ë‹Œ êµ­ê°€ì˜ ê²½ìš° ë‹¨ìˆœíˆ í‹°ì»¤ë§Œ ì…ë ¥í•  ê²½ìš° ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ì—†ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì¼ë³¸ì˜ â€˜ë„ì¿„ ì¼ë ‰íŠ¸ë¡ â€™ì€ ì¼ë³¸ ë‚´ì—ì„œ í‹°ì»¤ê°€ â€˜8035â€™ì´ë©°, ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œ ì´ë¥¼ ê²€ìƒ‰í•´ë³´ì.</p>
<div class="figure align-default" id="same-ticker">
<img alt="_images/same_ticker.png" src="_images/same_ticker.png" />
<p class="caption"><span class="caption-number">Fig. 11.13 </span><span class="caption-text">ì¤‘ë³µ í‹°ì»¤</span><a class="headerlink" href="#same-ticker" title="Permalink to this image">Â¶</a></p>
</div>
<p>ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë„ì¿„ ì¼ë ‰íŠ¸ë¡  ë¿ë§Œ ì•„ë‹ˆë¼ í™ì½©ì— ìƒì¥ëœ â€˜Janco Holdings Limitedâ€™ë¼ëŠ” ì£¼ì‹ ì—­ì‹œ í‹°ì»¤ê°€ 8035 ì´ë‹¤. ì´ì²˜ëŸ¼ ê°ê¸° ë‹¤ë¥¸ êµ­ê°€ì—ì„œ ì¤‘ë³µëœ í‹°ì»¤ê°€ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ì¢…ì¢… ë°œìƒë˜ë¯€ë¡œ, ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ í˜¹ì€ ì—¬ëŸ¬ ë²¤ë”ì˜ ê²½ìš° â€˜í‹°ì»¤.êµ­ê°€ì½”ë“œâ€™ í˜•íƒœë¥¼ í†µí•´ ì´ë“¤ì„ êµ¬ë¶„í•œë‹¤. ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œ ì¼ë³¸ì˜ êµ­ê°€ì½”ë“œëŠ” â€˜Tâ€™ ì´ë‹¤. ì´ë¥¼ ì´ìš©í•´ ë„ì¿„ ì¼ë ‰íŠ¸ë¡ ì˜ ì£¼ê°€ë¥¼ ë°›ëŠ” ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas_datareader</span> <span class="k">as</span> <span class="nn">web</span>

<span class="n">price</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;8035.T&#39;</span><span class="p">,</span> <span class="s1">&#39;yahoo&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Adj Close</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-08-07</th>
      <td>15140.0</td>
      <td>14925.0</td>
      <td>14975.0</td>
      <td>15030.0</td>
      <td>878700.0</td>
      <td>12897.755859</td>
    </tr>
    <tr>
      <th>2017-08-08</th>
      <td>15330.0</td>
      <td>15065.0</td>
      <td>15330.0</td>
      <td>15095.0</td>
      <td>925600.0</td>
      <td>12953.536133</td>
    </tr>
    <tr>
      <th>2017-08-09</th>
      <td>14995.0</td>
      <td>14715.0</td>
      <td>14900.0</td>
      <td>14770.0</td>
      <td>1586300.0</td>
      <td>12674.641602</td>
    </tr>
    <tr>
      <th>2017-08-10</th>
      <td>14970.0</td>
      <td>14790.0</td>
      <td>14915.0</td>
      <td>14855.0</td>
      <td>1024100.0</td>
      <td>12747.582031</td>
    </tr>
    <tr>
      <th>2017-08-11</th>
      <td>14855.0</td>
      <td>14855.0</td>
      <td>14855.0</td>
      <td>14855.0</td>
      <td>0.0</td>
      <td>12747.582031</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>ë¯¸êµ­ì˜ ê²½ìš°ëŠ” êµ­ê°€ì½”ë“œê°€ í•„ìš”ì—†ì´ ë‹¨ìˆœíˆ í‹°ì»¤ë§Œ ì…ë ¥í•˜ë©´ ëœë‹¤.</p></li>
<li><p>êµ­ë‚´ ì£¼ê°€ ì—­ì‹œ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ë¥¼ í†µí•´ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¼ë¶€ ì¤‘ì†Œí˜•ì£¼ì˜ ê²½ìš° ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì–´ êµ­ë‚´ ì‚¬ì´íŠ¸ë¥¼ ì´ìš©í•´ ìˆ˜ì§‘í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.</p></li>
</ul>
</div>
<div class="section" id="id7">
<h3><span class="section-number">11.3.1. </span>ì „ ì¢…ëª© ì£¼ê°€ ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id7" title="Permalink to this headline">Â¶</a></h3>
<p>ë¯¸êµ­ ë°ì´í„° ì—­ì‹œ êµ­ë‚´ ì „ì¢…ëª© ì£¼ê°€ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ê³  DBì— ì €ì¥í–ˆë˜ê²ƒê³¼ ë™ì¼í•˜ê²Œ forë¬¸ì„ ì´ìš©í•˜ë©´ ëœë‹¤. ë¨¼ì € SQLì—ì„œ ì£¼ê°€ ë°ì´í„°ì— í•´ë‹¹í•˜ëŠ” í…Œì´ë¸”(global_price)ë¥¼ ë§Œë“ ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>use stock_db;

create table global_price
(
    Date date,
    High double,
    Low double,
    Open double,
    Close double,
    Volume double,
    `Adj Close` double,
    ticker varchar(20),
    primary key(Date, ticker)
);
</pre></div>
</div>
</div>
</div>
<p>íŒŒì´ì¬ì—ì„œ ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ forë¬¸ì„ í†µí•´ ì „ì¢…ëª© ì£¼ê°€ê°€ DBì— ì €ì¥ëœë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># íŒ¨í‚¤ì§€ ë¶ˆëŸ¬ì˜¤ê¸°</span>
<span class="kn">import</span> <span class="nn">pymysql</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pandas_datareader</span> <span class="k">as</span> <span class="nn">web</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1"># DB ì—°ê²°</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;mysql+pymysql://root:1234@127.0.0.1:3306/stock_db&#39;</span><span class="p">)</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                      <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span>
                      <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                      <span class="n">db</span><span class="o">=</span><span class="s1">&#39;stock_db&#39;</span><span class="p">,</span>
                      <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>

<span class="n">mycursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># í‹°ì»¤ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</span>
<span class="n">ticker_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select * from global_ticker</span>
<span class="s2">where date = (select max(date) from global_ticker)</span>
<span class="s2">and country = &#39;United States&#39;;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="c1"># DB ì €ì¥ ì¿¼ë¦¬</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    insert into global_price (Date, High, Low, Open, Close, Volume, `Adj Close`, ticker)</span>
<span class="s2">    values (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">) as new</span>
<span class="s2">    on duplicate key update</span>
<span class="s2">    High = new.High, Low = new.Low, Open = new.Open, Close = new.Close,</span>
<span class="s2">    Volume = new.Volume, `Adj Close` = new.`Adj Close`;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># ì˜¤ë¥˜ ë°œìƒì‹œ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸ ìƒì„±</span>
<span class="n">error_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># ì „ì¢…ëª© ì£¼ê°€ ë‹¤ìš´ë¡œë“œ ë° ì €ì¥</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticker_list</span><span class="p">))):</span>

    <span class="c1"># í‹°ì»¤ ì„ íƒ</span>
    <span class="n">ticker</span> <span class="o">=</span> <span class="n">ticker_list</span><span class="p">[</span><span class="s1">&#39;Symbol&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># ì˜¤ë¥˜ ë°œìƒ ì‹œ ì´ë¥¼ ë¬´ì‹œí•˜ê³  ë‹¤ìŒ ë£¨í”„ë¡œ ì§„í–‰</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="c1"># url ìƒì„±</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="s1">&#39;yahoo&#39;</span><span class="p">)</span>

        <span class="c1"># ë°ì´í„° í´ë Œì§•</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">price</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticker</span>

        <span class="c1"># ì£¼ê°€ ë°ì´í„°ë¥¼ DBì— ì €ì¥</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">mycursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">except</span><span class="p">:</span>

        <span class="c1"># ì˜¤ë¥˜ ë°œìƒì‹œ error_listì— í‹°ì»¤ ì €ì¥í•˜ê³  ë„˜ì–´ê°€ê¸°</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

    <span class="c1"># íƒ€ì„ìŠ¬ë¦½ ì ìš©</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># DB ì—°ê²° ì¢…ë£Œ</span>
<span class="n">engine</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>DBì— ì—°ê²°í•œë‹¤.</p></li>
<li><p>ê¸°ì¤€ì¼ì´ ìµœëŒ€, ì¦‰ ìµœê·¼ì¼ ê¸°ì¤€ ë³´í†µì£¼ì— í•´ë‹¹í•˜ë©°, ë¯¸êµ­ ì¢…ëª©ì˜ ë¦¬ìŠ¤íŠ¸(ticker_list)ë§Œ ë¶ˆëŸ¬ì˜¨ë‹¤.</p></li>
<li><p>DBì— ì €ì¥í•  ì¿¼ë¦¬(query)ë¥¼ ì…ë ¥í•œë‹¤.</p></li>
<li><p>í˜ì´ì§€ ì˜¤ë¥˜, í†µì‹  ì˜¤ë¥˜ ë“± ì˜¤ë¥˜ê°€ ë°œìƒí•œ í‹°ì»¤ëª…ì„ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸(error_list)ë¥¼ ë§Œë“ ë‹¤.</p></li>
<li><p>forë¬¸ì„ í†µí•´ ì „ì¢…ëª© ì£¼ê°€ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ìœ¼ë©°, ì§„í–‰ìƒí™©ì„ ì•Œê¸°ìœ„í•´ <code class="docutils literal notranslate"><span class="pre">tqdm()</span></code> í•¨ìˆ˜ë¥¼ ì´ìš©í•œë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataReader()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œ ì£¼ê°€ë¥¼ ë°›ì€ í›„ í´ë Œì§• ì²˜ë¦¬í•œë‹¤. ê·¸ í›„ ì£¼ê°€ ë°ì´í„°ë¥¼ DBì— ì €ì¥í•œë‹¤.</p></li>
<li><p>try exceptë¬¸ì„ í†µí•´ ì˜¤ë¥˜ê°€ ë°œìƒì‹œ â€˜error_listâ€™ì— í‹°ì»¤ë¥¼ ì €ì¥í•œë‹¤.</p></li>
<li><p>ë¬´í•œ í¬ë¡¤ë§ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ í•œ ë²ˆì˜ ë£¨í”„ê°€ ëë‚  ë•Œë§ˆë‹¤ íƒ€ì„ìŠ¬ë¦½ì„ ì ìš©í•œë‹¤.</p></li>
<li><p>ëª¨ë“  ì‘ì—…ì´ ëë‚˜ë©´ DBì™€ì˜ ì—°ê²°ì„ ì¢…ë£Œí•œë‹¤.</p></li>
</ol>
<div class="figure align-default" id="sql-price">
<img alt="_images/sql_price.png" src="_images/sql_price.png" />
<p class="caption"><span class="caption-number">Fig. 11.14 </span><span class="caption-text">ê¸€ë¡œë²Œ ì£¼ê°€ í…Œì´ë¸”</span><a class="headerlink" href="#sql-price" title="Permalink to this image">Â¶</a></p>
</div>
<p>ì‘ì—…ì´ ì¢…ë£Œëœ í›„ â€˜error_listâ€™ì—ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•´ ë‹¤ìš´ë¡œë“œ ë°›ì§€ ëª»í•œ ì¢…ëª©ë“¤ì´ ì…ë ¥ë˜ì–´ ìˆë‹¤. ì´ëŠ” í˜ì´ì§€ ì˜¤ë¥˜ë‚˜ í†µì‹  ì˜¤ë¥˜ ë•Œë¬¸ì¼ ìˆ˜ë„ ìˆìœ¼ë©°, ì¸ë² ìŠ¤íŒ…ë‹·ì»´ì—ëŠ” ì¡´ì¬í•˜ì§€ë§Œ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¢…ëª©ì¼ ìˆ˜ë„ ìˆë‹¤.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ë¯¸êµ­ì´ ì•„ë‹Œ íƒ€ êµ­ê°€ì˜ ê²½ìš° í‹°ì»¤ì˜ ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ticker ì—´ì— êµ­ê°€ì½”ë“œë„ í•¨ê»˜ ì…ë ¥í•œ í›„ DBì— ì €ì¥í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.</p>
</div>
</div>
</div>
<div class="section" id="id8">
<h2><span class="section-number">11.4. </span>ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id8" title="Permalink to this headline">Â¶</a></h2>
<p>ì¬ë¬´ì œí‘œ ì—­ì‹œ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œ êµ¬í•  ìˆ˜ ìˆìœ¼ë©°, [Financials] íƒ­ì„ í´ë¦­í•˜ë©´ ì—°ê°„ ë° ë¶„ê¸° ê¸°ì¤€ ì¬ë¬´ì œí‘œë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. í•´ë‹¹ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ íŒ¨í‚¤ì§€ê°€ ì¡´ì¬í•˜ë©°, ë³¸ ì±…ì—ì„œëŠ” ê·¸ ì¤‘ì—ì„œë„ yahoo_fin íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ë‹¤. í•´ë‹¹ íŒ¨í‚¤ì§€ì˜ ìì„¸í•œ ì„¤ëª…ì€ ì•„ë˜ ì‚¬ì´íŠ¸ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">theautomatic</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">yahoo_fin</span><span class="o">-</span><span class="n">documentation</span><span class="o">/</span>
</pre></div>
</div>
<div class="figure align-default" id="yahoo-fs">
<img alt="_images/yahoo_fs.png" src="_images/yahoo_fs.png" />
<p class="caption"><span class="caption-number">Fig. 11.15 </span><span class="caption-text">ì•¼í›„ì—ì„œ ì œê³µí•˜ëŠ” ì¬ë¬´ì œí‘œ ë°ì´í„°</span><a class="headerlink" href="#yahoo-fs" title="Permalink to this image">Â¶</a></p>
</div>
<p>í•´ë‹¹ íŒ¨í‚¤ì§€ì˜ <code class="docutils literal notranslate"><span class="pre">get_financials()</span></code> í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ì†ìµê³„ì‚°ì„œ, ì¬ë¬´ìƒíƒœí‘œ, í˜„ê¸ˆíë¦„í‘œë¥¼ í•œë²ˆì— ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, ì˜ˆì‹œë¡œ ì• í”Œ(AAPL) ì¢…ëª©ì˜ ì—°ê°„ ì¬ë¬´ì œí‘œë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ê² ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yahoo_fin.stock_info</span> <span class="k">as</span> <span class="nn">si</span>

<span class="n">data_y</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">get_financials</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="n">yearly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quarterly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">data_y</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;yearly_income_statement&#39;, &#39;yearly_balance_sheet&#39;, &#39;yearly_cash_flow&#39;])
</pre></div>
</div>
</div>
</div>
<p>ì¸ìì˜ <code class="docutils literal notranslate"><span class="pre">yearly</span> <span class="pre">=</span> <span class="pre">True,</span> <span class="pre">quarterly</span> <span class="pre">=</span> <span class="pre">False</span></code>ëŠ” ì—°ê°„ ì¬ë¬´ì œí‘œë¥¼ ì˜ë¯¸í•˜ë©°, ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ì„¸ ì¢…ë¥˜ì˜ ì¬ë¬´ì œí‘œê°€ ë‹¤ìš´ë¡œë“œ ë˜ì—ˆë‹¤. ì´ë¥¼ í•˜ë‚˜ì˜ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ í•©ì³ì£¼ë„ë¡ í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">data_fs_y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_y</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">data_fs_y</span> <span class="o">=</span> <span class="n">data_fs_y</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data_fs_y</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="n">data_fs_y</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>

<span class="n">data_fs_y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>account</th>
      <th>date</th>
      <th>value</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>researchDevelopment</td>
      <td>2021-09-25</td>
      <td>21914000000</td>
      <td>y</td>
    </tr>
    <tr>
      <th>1</th>
      <td>researchDevelopment</td>
      <td>2020-09-26</td>
      <td>18752000000</td>
      <td>y</td>
    </tr>
    <tr>
      <th>2</th>
      <td>researchDevelopment</td>
      <td>2019-09-28</td>
      <td>16217000000</td>
      <td>y</td>
    </tr>
    <tr>
      <th>3</th>
      <td>researchDevelopment</td>
      <td>2018-09-29</td>
      <td>14236000000</td>
      <td>y</td>
    </tr>
    <tr>
      <th>4</th>
      <td>incomeBeforeTax</td>
      <td>2021-09-25</td>
      <td>109207000000</td>
      <td>y</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ol class="simple">
<li><p>ë”•ì…”ë„ˆë¦¬ì˜ valueì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ë§Œì„ ì„ íƒí•œ í›„ <code class="docutils literal notranslate"><span class="pre">concat()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ ë°ì´í„°í”„ë ˆì„ í˜•íƒœë¡œ í•©ì³ì¤€ë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stack()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ìœ„ì—ì„œ ì•„ë˜ë¡œ ê¸¸ê²Œ ì¬êµ¬ì¡°í™” í•´ì£¼ë©°, <code class="docutils literal notranslate"><span class="pre">reset_index()</span></code>ë¥¼ í†µí•´ ì¸ë±ìŠ¤ë¥¼ ì´ˆê¸°í™”í•œë‹¤.</p></li>
<li><p>ì—´ ì´ë¦„ì„ ë³€ê²½í•œë‹¤.</p></li>
<li><p>freq ì—´ì— ì—°ê°„ì— í•´ë‹¹í•˜ëŠ” â€˜yâ€™ë¥¼ ì…ë ¥í•œë‹¤.</p></li>
</ol>
<p>ì´ì²˜ëŸ¼ íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ì—¬ ë¯¸êµ­ ì¬ë¬´ì œí‘œ ë°ì´í„°ë„ ë§¤ìš° ì‰½ê²Œ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆë‹¤. ë¶„ê¸°ë³„ ì¬ë¬´ì œí‘œë¥¼ ë°›ëŠ”ë²•ë„ ìœ„ì™€ ê°™ìœ¼ë©°, ì¸ìë§Œ <code class="docutils literal notranslate"><span class="pre">yearly=False,</span> <span class="pre">quarterly=True</span></code>ë¡œ ë³€ê²½í•˜ë©´ ëœë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_q</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">get_financials</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="n">yearly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quarterly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_fs_q</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_q</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">data_fs_q</span> <span class="o">=</span> <span class="n">data_fs_q</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data_fs_q</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="n">data_fs_q</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>

<span class="n">data_fs_q</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>account</th>
      <th>date</th>
      <th>value</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>researchDevelopment</td>
      <td>2022-06-25</td>
      <td>6797000000</td>
      <td>q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>researchDevelopment</td>
      <td>2022-03-26</td>
      <td>6387000000</td>
      <td>q</td>
    </tr>
    <tr>
      <th>2</th>
      <td>researchDevelopment</td>
      <td>2021-12-25</td>
      <td>6306000000</td>
      <td>q</td>
    </tr>
    <tr>
      <th>3</th>
      <td>researchDevelopment</td>
      <td>2021-09-25</td>
      <td>5772000000</td>
      <td>q</td>
    </tr>
    <tr>
      <th>4</th>
      <td>incomeBeforeTax</td>
      <td>2022-06-25</td>
      <td>23066000000</td>
      <td>q</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="id9">
<h3><span class="section-number">11.4.1. </span>ì „ ì¢…ëª© ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id9" title="Permalink to this headline">Â¶</a></h3>
<p>forë¬¸ì„ ì´ìš©í•˜ì—¬ ì „ ì¢…ëª© ì¬ë¬´ì œí‘œë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ë„ë¡ í•˜ê² ë‹¤. ë¨¼ì € SQLì—ì„œ ì¬ë¬´ì œí‘œ ë°ì´í„°ì— í•´ë‹¹í•˜ëŠ” í…Œì´ë¸”(global_fs)ë¥¼ ë§Œë“ ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">stock_db</span><span class="p">;</span>

<span class="n">create</span> <span class="n">table</span> <span class="n">global_fs</span>
<span class="p">(</span>
    <span class="n">account</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">date</span> <span class="n">date</span><span class="p">,</span>
    <span class="n">value</span> <span class="n">double</span><span class="p">,</span>
    <span class="n">freq</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">ticker</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>    
    <span class="n">primary</span> <span class="n">key</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>ì´ì œ íŒŒì´ì¬ì—ì„œ ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ forë¬¸ì„ í†µí•´ ì „ ì¢…ëª© ì¬ë¬´ì œí‘œê°€ DBì— ì €ì¥ëœë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># íŒ¨í‚¤ì§€ ë¶ˆëŸ¬ì˜¤ê¸°</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">pymysql</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">yahoo_fin.stock_info</span> <span class="k">as</span> <span class="nn">si</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1"># DB ì—°ê²°</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;mysql+pymysql://root:1234@127.0.0.1:3306/stock_db&#39;</span><span class="p">)</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                      <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span>
                      <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                      <span class="n">db</span><span class="o">=</span><span class="s1">&#39;stock_db&#39;</span><span class="p">,</span>
                      <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>

<span class="n">mycursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># í‹°ì»¤ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</span>
<span class="n">ticker_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select * from global_ticker</span>
<span class="s2">where date = (select max(date) from global_ticker)</span>
<span class="s2">and country = &#39;United States&#39;;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="c1"># DB ì €ì¥ ì¿¼ë¦¬</span>
<span class="n">query_fs</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    insert into global_fs (account, date, value, freq, ticker)</span>
<span class="s2">    values (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">) as new</span>
<span class="s2">    on duplicate key update</span>
<span class="s2">    value = new.value;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># ì˜¤ë¥˜ ë°œìƒì‹œ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸ ìƒì„±</span>
<span class="n">error_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># ì „ì¢…ëª© ì£¼ê°€ ë‹¤ìš´ë¡œë“œ ë° ì €ì¥</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticker_list</span><span class="p">))):</span>

    <span class="c1"># í‹°ì»¤ ì„ íƒ</span>
    <span class="n">ticker</span> <span class="o">=</span> <span class="n">ticker_list</span><span class="p">[</span><span class="s1">&#39;Symbol&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># ì˜¤ë¥˜ ë°œìƒ ì‹œ ì´ë¥¼ ë¬´ì‹œí•˜ê³  ë‹¤ìŒ ë£¨í”„ë¡œ ì§„í–‰</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="c1"># ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ</span>
        <span class="n">data_y</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">get_financials</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">yearly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quarterly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data_fs_y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_y</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">data_fs_y</span> <span class="o">=</span> <span class="n">data_fs_y</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">data_fs_y</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="n">data_fs_y</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>

        <span class="n">data_q</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">get_financials</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="n">yearly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quarterly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">data_fs_q</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_q</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">data_fs_q</span> <span class="o">=</span> <span class="n">data_fs_q</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">data_fs_q</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="n">data_fs_q</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>

        <span class="n">data_fs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_fs_y</span><span class="p">,</span> <span class="n">data_fs_q</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">data_fs</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticker</span>

        <span class="c1"># ì£¼ê°€ ë°ì´í„°ë¥¼ DBì— ì €ì¥</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">data_fs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">mycursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query_fs</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">except</span><span class="p">:</span>

        <span class="c1"># ì˜¤ë¥˜ ë°œìƒì‹œ error_listì— í‹°ì»¤ ì €ì¥í•˜ê³  ë„˜ì–´ê°€ê¸°</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

    <span class="c1"># íƒ€ì„ìŠ¬ë¦½ ì ìš©</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># DB ì—°ê²° ì¢…ë£Œ</span>
<span class="n">engine</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>DBì— ì—°ê²°í•œë‹¤.</p></li>
<li><p>ê¸°ì¤€ì¼ì´ ìµœëŒ€, ì¦‰ ìµœê·¼ì¼ ê¸°ì¤€ ë³´í†µì£¼ì— í•´ë‹¹í•˜ë©°, ë¯¸êµ­ ì¢…ëª©ì˜ ë¦¬ìŠ¤íŠ¸(ticker_list)ë§Œ ë¶ˆëŸ¬ì˜¨ë‹¤.</p></li>
<li><p>DBì— ì €ì¥í•  ì¿¼ë¦¬(query)ë¥¼ ì…ë ¥í•œë‹¤.</p></li>
<li><p>í˜ì´ì§€ ì˜¤ë¥˜, í†µì‹  ì˜¤ë¥˜ ë“± ì˜¤ë¥˜ê°€ ë°œìƒí•œ í‹°ì»¤ëª…ì„ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸(error_list)ë¥¼ ë§Œë“ ë‹¤.</p></li>
<li><p>forë¬¸ì„ í†µí•´ ì „ì¢…ëª© ì¬ë¬´ì œí‘œë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ìœ¼ë©°, ì§„í–‰ìƒí™©ì„ ì•Œê¸°ìœ„í•´ tqdm() í•¨ìˆ˜ë¥¼ ì´ìš©í•œë‹¤.</p></li>
<li><p>get_financials() í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ì—°ê°„ ë° ë¶„ê¸° ì¬ë¬´ì œí‘œë¥¼ ë°›ì€ í›„, ë‘ í…Œì´ë¸”ì„ concat() í•¨ìˆ˜ë¥¼ í†µí•´ í–‰ìœ¼ë¡œ ë¬¶ì–´ì¤€ë‹¤.</p></li>
<li><p>ì¬ë¬´ì œí‘œ ë°ì´í„°ë¥¼ DBì— ì €ì¥í•œë‹¤.</p></li>
<li><p>ë¬´í•œ í¬ë¡¤ë§ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ í•œ ë²ˆì˜ ë£¨í”„ê°€ ëë‚  ë•Œë§ˆë‹¤ íƒ€ì„ìŠ¬ë¦½ì„ ì ìš©í•œë‹¤.</p></li>
<li><p>ëª¨ë“  ì‘ì—…ì´ ëë‚˜ë©´ DBì™€ì˜ ì—°ê²°ì„ ì¢…ë£Œí•œë‹¤.</p></li>
</ol>
<div class="figure align-default" id="sql-fs">
<img alt="_images/sql_fs.png" src="_images/sql_fs.png" />
<p class="caption"><span class="caption-number">Fig. 11.16 </span><span class="caption-text">ê¸€ë¡œë²Œ ì¬ë¬´ì œí‘œ í…Œì´ë¸”</span><a class="headerlink" href="#sql-fs" title="Permalink to this image">Â¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ë¯¸êµ­ ì¢…ëª©ë“¤ì˜ ê°€ì¹˜ì§€í‘œëŠ” êµ­ë‚´ ì¬ë¬´ì œí‘œ ë°ì´í„°ë¥¼ ì´ìš©í•´ ê°€ì¹˜ì§€í‘œë¥¼ ê³„ì‚°í–ˆë˜ ê²ƒê³¼ ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ê³„ì‚°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì´ëŠ” ìƒëµí•˜ë„ë¡ í•œë‹¤.</p>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="data_korea.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">10. </span>êµ­ë‚´ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="data_ref.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">12. </span>íˆ¬ì ì°¸ê³ ìš© ë°ì´í„° ìˆ˜ì§‘</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By ì´í˜„ì—´<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>