

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>11. ì „ ì„¸ê³„ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸° &#8212; íŒŒì´ì¬ì„ ì´ìš©í•œ í€€íŠ¸ íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ ë§Œë“¤ê¸°</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "hyunyulhenry/quant_py");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "ğŸ’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'data_global_revision';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="12. íˆ¬ì ì°¸ê³ ìš© ë°ì´í„° ìˆ˜ì§‘" href="data_ref.html" />
    <link rel="prev" title="10. êµ­ë‚´ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘" href="data_korea.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    íŒŒì´ì¬ì„ ì´ìš©í•œ í€€íŠ¸ íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ ë§Œë“¤ê¸°
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">í€€íŠ¸ì™€ í”„ë¡œê·¸ë˜ë° ê¸°ì´ˆ ë°°ì›Œë³´ê¸°</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="quant_intro.html">1. í€€íŠ¸ì— ëŒ€í•´ ì•Œì•„ë³´ê¸°</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">2. íŒŒì´ì¬ ê¸°ì´ˆ ë°°ì›Œë³´ê¸°</a></li>
<li class="toctree-l1"><a class="reference internal" href="eda.html">3. ë°ì´í„° ë¶„ì„ ë°°ì›Œë³´ê¸°</a></li>
<li class="toctree-l1"><a class="reference internal" href="plot.html">4. ë°ì´í„° ì‹œê°í™” ë°°ì›Œë³´ê¸°</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql.html">5. SQL ê¸°ì´ˆ ë°°ì›Œë³´ê¸°</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql_in_python.html">6. íŒŒì´ì¬ì—ì„œ SQL ì—°ê²°í•˜ê¸°</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">í¬ë¡¤ë§ì„ ì´ìš©í•œ ë°ì´í„° ìˆ˜ì§‘</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="web.html">7. í¬ë¡¤ë§ì„ ìœ„í•œ ì›¹ ê¸°ë³¸ì§€ì‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="crawl_basic.html">8. ì •ì  í¬ë¡¤ë§ ì‹¤ìŠµí•˜ê¸°</a></li>
<li class="toctree-l1"><a class="reference internal" href="selenium.html">9. ë™ì  í¬ë¡¤ë§ê³¼ ì •ê·œ í‘œí˜„ì‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_korea.html">10. êµ­ë‚´ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">11. ì „ ì„¸ê³„ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸°</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_ref.html">12. íˆ¬ì ì°¸ê³ ìš© ë°ì´í„° ìˆ˜ì§‘</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±, ë°±í…ŒìŠ¤íŠ¸ ë° ë§¤ë§¤í•˜ê¸°</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="factor.html">13. í€€íŠ¸ ì „ëµì„ ì´ìš©í•œ ì¢…ëª©ì„ ì •</a></li>
<li class="toctree-l1"><a class="reference internal" href="portfolio.html">14. í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ì „ëµ</a></li>
<li class="toctree-l1"><a class="reference internal" href="technical.html">15. íŠ¸ë ˆì´ë”©ì„ ìœ„í•œ ê¸°ìˆ ì  ì§€í‘œ</a></li>
<li class="toctree-l1"><a class="reference internal" href="backtest.html">16. ë°±í…ŒìŠ¤íŒ… ì‹œë®¬ë ˆì´ì…˜</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_trading.html">17. ì¦ê¶Œì‚¬ API ì—°ê²°ê³¼ ë§¤ë§¤í•˜ê¸°</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ë¶€ë¡</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install_python.html">íŒŒì´ì¬ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜í•˜ê¸°</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_sql.html">SQL ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜í•˜ê¸°</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/data_global_revision.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ì „ ì„¸ê³„ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸°</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">11.1. ìœ ë£Œ ë°ì´í„° ë²¤ë” ì´ìš©í•˜ê¸°</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#api-token">11.1.1. ê°€ì… ë° API token ë°›ê¸°</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">11.1.2. ë°ì´í„° ë‹¤ìš´ë¡œë“œ</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">11.2. í‹°ì»¤ ìˆ˜ì§‘í•˜ê¸°</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">11.2.1. ì „ ì¢…ëª© í‹°ì»¤ í¬ë¡¤ë§</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">11.3. ì£¼ê°€ ë‹¤ìš´ë¡œë“œ</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">11.3.1. ì „ ì¢…ëª© ì£¼ê°€ ë‹¤ìš´ë¡œë“œ</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">11.4. ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">11.4.1. ì „ ì¢…ëª© ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">11. </span>ì „ ì„¸ê³„ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸°<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<p>í€€íŠ¸ íˆ¬ìì˜ ì¥ì ì€ ë°ì´í„°ë§Œ ìˆë‹¤ë©´ ë™ì¼í•œ íˆ¬ì ì „ëµì„ ì „ ì„¸ê³„ ëª¨ë“  êµ­ê°€ì— ì ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤. ì´ë²ˆ ì¥ì—ì„œëŠ” ì „ ì„¸ê³„ ì¢…ëª©ì˜ í‹°ì»¤ ìˆ˜ì§‘ ë° ì£¼ê°€, ì¬ë¬´ì œí‘œ, ê°€ì¹˜ì§€í‘œë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ë‹¤.</p>
<section id="id2">
<h2><span class="section-number">11.1. </span>ìœ ë£Œ ë°ì´í„° ë²¤ë” ì´ìš©í•˜ê¸°<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>ë¯¸êµ­ ì‹œì¥ì˜ ë°ì´í„°ë§Œ í•„ìš”í•  ê²½ìš° ìœ ë£Œ ë°ì´í„° ë²¤ë”ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²•ì´ë‹¤. ë¯¸êµ­ì—ëŠ” ê¸ˆìœµ ë°ì´í„°ë¥¼ APIë¡œ ì œê³µí•˜ëŠ” ìˆ˜ë§ì€ ì—…ì²´ê°€ ìˆìœ¼ë©°, tiingoì˜ ê²½ìš°ëŠ” ì›” $10ë§Œ ì§€ë¶ˆí•˜ë©´ ë¯¸êµ­ê³¼ ì¤‘êµ­ì˜ 4ë§Œì—¬ê°œ ì¢…ëª©ì— ëŒ€í•œ ë°ì´í„°ë¥¼ API í˜•íƒœë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤. ì´ëŠ” ìƒì¥íì§€ëœ ì¢…ëª©ì„ ì»¤ë²„í•  ë¿ë§Œ ì•„ë‹ˆë¼, APIë¥¼ ì´ìš©í•˜ë¯€ë¡œ í¬ë¡¤ë§ê³¼ëŠ” ë¹„êµí•  ìˆ˜ ì—†ëŠ” ì†ë„ë¡œ ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤. ì´ ì™¸ì—ë„ Alpha Vantage, Quandl, Polygon ë“± ìˆ˜ë§ì€ ë°ì´í„° ë²¤ë”ê°€ ì¡´ì¬í•œë‹¤.</p>
<figure class="align-default" id="tiingo">
<a class="reference internal image-reference" href="_images/tiingo.png"><img alt="_images/tiingo.png" src="_images/tiingo.png" style="width: 564.1999999999999px; height: 579.5999999999999px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 11.1 </span><span class="caption-text">tiingoì˜ ìœ /ë¬´ë£Œ ì„œë¹„ìŠ¤ ë¹„êµ</span><a class="headerlink" href="#tiingo" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>tiingoëŠ” ë¬´ë£Œ ê³„ì •ë„ í•˜ë£¨ 1,000íšŒê¹Œì§€ API ìš”ì²­ì„ í•  ìˆ˜ ìˆìœ¼ë©°, íŒŒì´ì¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íŒ¨í‚¤ì§€ë„ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•´ë³´ë„ë¡ í•˜ê² ë‹¤.</p>
<section id="api-token">
<h3><span class="section-number">11.1.1. </span>ê°€ì… ë° API token ë°›ê¸°<a class="headerlink" href="#api-token" title="Permalink to this heading">#</a></h3>
<p>ë¨¼ì € <a class="reference external" href="https://api.tiingo.com/">https://api.tiingo.com/</a> ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ì—¬ ìš°ì¸¡ ìƒë‹¨ì˜ [Sign-up]ì„ í´ë¦­í•´ íšŒì›ê°€ì…ì„ í•œë‹¤. ê·¸ í›„ ë¡œê·¸ì¸ì„ í•œ í›„ ìš°ì¸¡ ìƒë‹¨ì—ì„œ ë³¸ì¸ì˜ IDë¥¼ í´ë¦­í•œ í›„ [Account]ë¥¼ ì„ íƒ, ì¢Œì¸¡ ë©”ë‰´ì˜ [API] ë¶€ë¶„ì—ì„œ [Token]ì„ í´ë¦­í•˜ë©´ ë³¸ì¸ì˜ API tokenì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<figure class="align-default" id="token">
<img alt="_images/token1.png" src="_images/token1.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.2 </span><span class="caption-text">API token í™•ì¸</span><a class="headerlink" href="#token" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>ë°œê¸‰ë°›ì€ í† í°ì„ PCì— ì €ì¥í•  ê²½ìš°, keyring íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ë©´ ì•ˆì „í•˜ê²Œ ì €ì¥í•  ìˆ˜ ìˆë‹¤. íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•´ ì•”í˜¸ë‚˜ í‚¤ ê°’ì„ ì €ì¥í•˜ëŠ” ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">keyring</span>

<span class="n">keyring</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;System&#39;</span><span class="p">,</span> <span class="s1">&#39;User Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Password&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[System]ì—ëŠ” ì‹œìŠ¤í…œ ì¢…ë¥˜, [User Name]ì—ëŠ” ë³¸ì¸ì˜ ì´ë¦„, [Password]ì—ëŠ” ë°œê¸‰ë°›ì€ API Keyë¥¼ ì…ë ¥í•œë‹¤. í•œë²ˆ ì…ë ¥ëœ ê°’ì€ ê³„ì† ì €ì¥ë˜ì–´ ìˆë‹¤. ì €ì¥í•œ í‚¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">api_key</span> <span class="o">=</span> <span class="n">keyring</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="s1">&#39;System&#39;</span><span class="p">,</span> <span class="s1">&#39;User Name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>ì´ì œ â€˜Sysyemâ€™ì—ëŠ” â€˜tiingoâ€™, â€˜User Nameâ€™ì—ëŠ” ë³¸ì¸ì˜ ì´ë¦„, â€˜Passwordâ€™ì—ëŠ” ìœ„ì—ì„œ ë°œê¸‰ë°›ì€ API Tokenì„ ì…ë ¥í•´ í† í°ì„ ì €ì¥í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">keyring</span>

<span class="n">keyring</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;tiingo&#39;</span><span class="p">,</span> <span class="s1">&#39;User Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Your API Token&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h3><span class="section-number">11.1.2. </span>ë°ì´í„° ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<p>tiingo íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•´ ë°ì´í„°ë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ê² ë‹¤. ë°ì´í„°ë¥¼ ë°›ê¸°ìœ„í•´ API ì ‘ì†í™˜ê²½ì„ ì…‹íŒ…í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tiingo</span> <span class="kn">import</span> <span class="n">TiingoClient</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">keyring</span>

<span class="n">api_key</span> <span class="o">=</span> <span class="n">keyring</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="s1">&#39;tiingo&#39;</span><span class="p">,</span> <span class="s1">&#39;Henry&#39;</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_key</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">TiingoClient</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>API tokenì„ ë¶ˆëŸ¬ì˜¨ í›„, ì ‘ì†í™˜ê²½ì— í•´ë‹¹í•˜ëŠ” configì— ì´ë¥¼ ì…ë ¥í•œë‹¤.</p>
<p>ë¨¼ì € tiingoì—ì„œ ì œê³µí•˜ëŠ” ì¢…ëª©ì€ ì–´ë– í•œ ê²ƒì´ ìˆëŠ”ì§€ í‹°ì»¤ ì •ë³´ë“¤ì„ í™•ì¸í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tickers</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_stock_tickers</span><span class="p">()</span>
<span class="n">tickers_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span>

<span class="n">tickers_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ticker</th>
      <th>exchange</th>
      <th>assetType</th>
      <th>priceCurrency</th>
      <th>startDate</th>
      <th>endDate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-P-H</td>
      <td>NYSE</td>
      <td>Stock</td>
      <td>USD</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>-P-S</td>
      <td>NYSE</td>
      <td>Stock</td>
      <td>USD</td>
      <td>2018-08-22</td>
      <td>2023-05-05</td>
    </tr>
    <tr>
      <th>2</th>
      <td>000001</td>
      <td>SHE</td>
      <td>Stock</td>
      <td>CNY</td>
      <td>2007-01-04</td>
      <td>2023-05-17</td>
    </tr>
    <tr>
      <th>3</th>
      <td>000002</td>
      <td>SHE</td>
      <td>Stock</td>
      <td>CNY</td>
      <td>2007-01-04</td>
      <td>2023-05-17</td>
    </tr>
    <tr>
      <th>4</th>
      <td>000003</td>
      <td>SHE</td>
      <td>Stock</td>
      <td>CNY</td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">list_stock_tickers()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ í‹°ì»¤ ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤. ticker(í‹°ì»¤), exchange(ê±°ë˜ì†Œ), assetType(ì£¼ì‹ ì¢…ë¥˜), priceCurrency(ê±°ë˜ í†µí™”), startDate(ì‹œì‘ì¼), endDate(ë§ˆê°ì¼) ì •ë³´ê°€ í‘œì‹œëœë‹¤. ê±°ë˜ì†Œì™€ í†µí™” ë³„ ì¢…ëª©ì´ ëª‡ê°œê°€ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tickers_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;exchange&#39;</span><span class="p">,</span> <span class="s1">&#39;priceCurrency&#39;</span><span class="p">])[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>exchange   priceCurrency
           USD               2462
AMEX       USD                 75
ASX        AUD                169
           USD               2173
BATS       USD                 12
CSE        USD                 32
EXPM       USD               1792
LSE        USD                 13
NASDAQ     USD              12441
NMFQS      USD                 28
NYSE       USD               7677
NYSE ARCA  USD                 74
NYSE MKT   USD                448
NYSE NAT   USD                  4
OTCBB      USD                643
OTCCE      USD               1118
OTCGREY    USD               3781
OTCMKTS    USD               1181
OTCQB      USD               1316
OTCQX      USD                776
PINK       USD              14988
SHE        CNY               2554
           HKD                 12
SHEB       HKD                 42
SHG        CNY               1933
           USD                  6
SHGB       USD                 44
Name: ticker, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>ì´ ì¤‘ ë§ˆì´ë„ˆ ê±°ë˜ì†Œë‚˜ ì¥ì™¸ ê±°ë˜ì†Œì˜ ê²½ìš° ì •ë³´ë¥¼ ë°›ì•„ë„ ìš°ë¦¬ë‚˜ë¼ì˜ ì¦ê¶Œì‚¬ë¥¼ í†µí•´ì„œëŠ” ì‹¤ì œë¡œ ê±°ë˜ë¥¼ í•  ìˆ˜ ì—†ì„ìˆ˜ë„ ìˆë‹¤. ë”°ë¼ì„œ ì‹¤ì œ ê±°ë˜ê°€ ê°€ëŠ¥í•œ ê±°ë˜ì†Œ ë°ì´í„°ë§Œ í•„í„°ë§í•œ í›„ í•´ë‹¹ ì¢…ëª©ë“¤ì„ ë°›ëŠ” ê²ƒì´ íš¨ìœ¨ì ì´ë‹¤.</p>
<p>ê° ì¢…ëª©ì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ë„ë¡ í•˜ë©°, ì˜ˆë¡œì¨ ì• í”Œ(AAPL)ì„ ì´ìš©í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ticker_metadata</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_ticker_metadata</span><span class="p">(</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ticker_metadata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ticker&#39;: &#39;AAPL&#39;, &#39;name&#39;: &#39;Apple Inc&#39;, &#39;description&#39;: &quot;Apple Inc. (Apple) designs, manufactures and markets mobile communication and media devices, personal computers, and portable digital music players, and a variety of related software, services, peripherals, networking solutions, and third-party digital content and applications. The Company&#39;s products and services include iPhone, iPad, Mac, iPod, Apple TV, a portfolio of consumer and professional software applications, the iOS and OS X operating systems, iCloud, and a variety of accessory, service and support offerings. The Company also delivers digital content and applications through the iTunes Store, App StoreSM, iBookstoreSM, and Mac App Store. The Company distributes its products worldwide through its retail stores, online stores, and direct sales force, as well as through third-party cellular network carriers, wholesalers, retailers, and value-added resellers. In February 2012, the Company acquired app-search engine Chomp.&quot;, &#39;startDate&#39;: &#39;1980-12-12&#39;, &#39;endDate&#39;: &#39;2023-05-17&#39;, &#39;exchangeCode&#39;: &#39;NASDAQ&#39;}
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get_ticker_metadata()</span></code> ë©”ì„œë“œ ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´ í‹°ì»¤, ì¢…ëª©ëª…, ì‚¬ì—…ë‚´ì—­ ë“± ëŒ€ëµì ì¸ ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.</p>
<p>ì´ì œ ì£¼ê°€ë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">historical_prices</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span>
                                         <span class="n">startDate</span><span class="o">=</span><span class="s1">&#39;2017-08-01&#39;</span><span class="p">,</span>
                                         <span class="n">frequency</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">)</span>

<span class="n">historical_prices</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>open</th>
      <th>volume</th>
      <th>adjClose</th>
      <th>adjHigh</th>
      <th>adjLow</th>
      <th>adjOpen</th>
      <th>adjVolume</th>
      <th>divCash</th>
      <th>splitFactor</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-08-01 00:00:00+00:00</th>
      <td>150.05</td>
      <td>150.22</td>
      <td>148.4100</td>
      <td>149.10</td>
      <td>24725526</td>
      <td>35.294300</td>
      <td>35.334287</td>
      <td>34.908544</td>
      <td>35.070844</td>
      <td>98902104</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2017-08-02 00:00:00+00:00</th>
      <td>157.14</td>
      <td>159.75</td>
      <td>156.1600</td>
      <td>159.28</td>
      <td>69222793</td>
      <td>36.961988</td>
      <td>37.575904</td>
      <td>36.731475</td>
      <td>37.465352</td>
      <td>276891172</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2017-08-03 00:00:00+00:00</th>
      <td>155.57</td>
      <td>157.21</td>
      <td>155.0200</td>
      <td>157.05</td>
      <td>26000738</td>
      <td>36.592698</td>
      <td>36.978453</td>
      <td>36.463328</td>
      <td>36.940819</td>
      <td>104002952</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2017-08-04 00:00:00+00:00</th>
      <td>156.39</td>
      <td>157.40</td>
      <td>155.6900</td>
      <td>156.07</td>
      <td>20349532</td>
      <td>36.785575</td>
      <td>37.023144</td>
      <td>36.620924</td>
      <td>36.710306</td>
      <td>81398128</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2017-08-07 00:00:00+00:00</th>
      <td>158.81</td>
      <td>158.92</td>
      <td>156.6701</td>
      <td>157.06</td>
      <td>21870321</td>
      <td>37.354800</td>
      <td>37.380674</td>
      <td>36.851460</td>
      <td>36.943171</td>
      <td>87481284</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get_dataframe()</span></code> ë©”ì„œë“œ ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´ close(ì¢…ê°€), high(ê³ ê°€), low(ì €ê°€), open(ì‹œê°€), volumne(ê±°ë˜ëŸ‰) ë° ìˆ˜ì •ì£¼ê°€ì™€ divCash(í˜„ê¸ˆ ë°°ë‹¹), splitFactor(ì£¼ì‹ë¶„í•  ì¡°ì •ê³„ìˆ˜)ê¹Œì§€ ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.</p>
<p>ì´ë²ˆì—ëŠ” ì¼ë³„ ê°€ì¹˜ì§€í‘œë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ì. (ë¬´ë£Œ ê³„ì •ì˜ ê²½ìš° ë‹¤ìš°ì¡´ìŠ¤ 30 ì§€ìˆ˜ì— í¬í•¨ë˜ëŠ” ì¢…ëª© ì •ë³´ë§Œ ì œê³µí•œë‹¤.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fundamentals_daily</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_fundamentals_daily</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">)</span>
<span class="n">fundamentals_daily_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">fundamentals_daily</span><span class="p">)</span>

<span class="n">fundamentals_daily_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>marketCap</th>
      <th>enterpriseVal</th>
      <th>peRatio</th>
      <th>pbRatio</th>
      <th>trailingPEG1Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-05-18T00:00:00.000Z</td>
      <td>1.365142e+12</td>
      <td>1.380598e+12</td>
      <td>23.859865</td>
      <td>17.406977</td>
      <td>6.702453</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-05-19T00:00:00.000Z</td>
      <td>1.357254e+12</td>
      <td>1.372710e+12</td>
      <td>23.721990</td>
      <td>17.306390</td>
      <td>6.663723</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-05-20T00:00:00.000Z</td>
      <td>1.383650e+12</td>
      <td>1.399106e+12</td>
      <td>24.183339</td>
      <td>17.642968</td>
      <td>6.793320</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-05-21T00:00:00.000Z</td>
      <td>1.373334e+12</td>
      <td>1.388790e+12</td>
      <td>24.003042</td>
      <td>17.511432</td>
      <td>6.742673</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-05-22T00:00:00.000Z</td>
      <td>1.382176e+12</td>
      <td>1.397632e+12</td>
      <td>24.157583</td>
      <td>17.624177</td>
      <td>6.786085</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get_fundamentals_daily()</span></code> ë©”ì„œë“œ ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´ ì¼ê°„ ì‹œê°€ì´ì•¡, ê¸°ì—…ê°€ì¹˜, PER, PBR, PEG ì •ë³´ê°€ JSON í˜•íƒœë¡œ ë°›ì•„ì§€ë©°, <code class="docutils literal notranslate"><span class="pre">from_records()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ ë°ì´í„°í”„ë ˆì„ í˜•íƒœë¡œ ë³€ê²½í•´ì¤€ë‹¤.</p>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì¬ë¬´ì œí‘œë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fundamentals_stmnts</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_fundamentals_statements</span><span class="p">(</span>
    <span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="n">startDate</span><span class="o">=</span><span class="s1">&#39;2019-01-01&#39;</span><span class="p">,</span> <span class="n">asReported</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">)</span>

<span class="n">df_fs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fundamentals_stmnts</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)])</span>
<span class="n">df_fs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_fs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df_fs</span> <span class="o">=</span> <span class="n">df_fs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">df_fs</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_fs</span> <span class="o">=</span> <span class="n">df_fs</span><span class="p">[</span><span class="n">df_fs</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>

<span class="n">df_fs</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>quarter</th>
      <th>statementType</th>
      <th>dataCode</th>
      <th>value</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-05-05</th>
      <td>2023</td>
      <td>2</td>
      <td>incomeStatement</td>
      <td>intexp</td>
      <td>930000000.0</td>
    </tr>
    <tr>
      <th>2023-05-05</th>
      <td>2023</td>
      <td>2</td>
      <td>balanceSheet</td>
      <td>acctRec</td>
      <td>35899000000.0</td>
    </tr>
    <tr>
      <th>2023-05-05</th>
      <td>2023</td>
      <td>2</td>
      <td>balanceSheet</td>
      <td>acctPay</td>
      <td>42945000000.0</td>
    </tr>
    <tr>
      <th>2023-05-05</th>
      <td>2023</td>
      <td>2</td>
      <td>cashFlow</td>
      <td>issrepayDebt</td>
      <td>-1996000000.0</td>
    </tr>
    <tr>
      <th>2023-05-05</th>
      <td>2023</td>
      <td>2</td>
      <td>incomeStatement</td>
      <td>opex</td>
      <td>13658000000.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_fundamentals_statements()</span></code> ë©”ì„œë“œ ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´ ì¬ë¬´ì œí‘œì˜ ì„¸ë¶€í•­ëª©ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. ë˜í•œ <code class="docutils literal notranslate"><span class="pre">fmt</span></code>ì€ í¬ë§· í˜•íƒœë¥¼ ì˜ë¯¸í•˜ë©°, JSONìœ¼ë¡œ ë°›ì„ ê²½ìš° í˜•íƒœê°€ ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•˜ë¯€ë¡œ CSVë¡œ ë°›ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p></li>
<li><p>í…ìŠ¤íŠ¸ í˜•íƒœë¡œ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ë¯€ë¡œ, í´ë Œì§•ì„ í†µí•´ ë°ì´í„°í”„ë ˆì„ í˜•íƒœë¡œ ë³€ê²½í•œë‹¤.</p></li>
<li><p>ì²«ë²ˆì§¸ í–‰ì„ ì—´ ì´ë¦„ìœ¼ë¡œ ì§€ì •í•œ í›„, í•´ë‹¹ í–‰ì€ ì‚­ì œí•œë‹¤.</p></li>
<li><p>â€˜dateâ€™ ì—´ì„ ì¸ë±ìŠ¤ë¡œ ì§€ì •í•œë‹¤.</p></li>
<li><p>â€˜dateâ€™ê°€ ë¹„ì–´ìˆëŠ” ë¶€ë¶„ì´ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì œê±°í•œë‹¤.</p></li>
</ol>
<p>ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ë©´ ì—°ê°„ ì¬ë¬´ì œí‘œì™€ ë¶„ê¸° ì¬ë¬´ì œí‘œì˜ ìƒì„¸ ì •ë³´ê°€ ë‹¤ìš´ë¡œë“œ ë  ë¿ë§Œ ì•„ë‹ˆë¼ ë°œí‘œ ë‚ ì§œ ë˜í•œ ì œê³µëœë‹¤. ì´ì²˜ëŸ¼ ìœ ë£Œ ë²¤ë”ë¥¼ ì´ìš©í•˜ë©´ í‹°ì»¤ ë° ì£¼ê°€, ì¬ë¬´ì œí‘œ, ê°€ì¹˜ì§€í‘œë¥¼ ë§¤ìš° ì‰½ê³  ë¹ ë¥´ê²Œ ë°›ì„ ìˆ˜ ìˆë‹¤.</p>
<p>tiingoì˜ API ì‚¬ìš©ë²• ë° íŒŒì´ì¬ íŒ¨í‚¤ì§€ ì‚¬ìš©ë²•ì€ ì•„ë˜ í˜ì´ì§€ì— ë‚˜ì™€ìˆë‹¤.</p>
<ul class="simple">
<li><p>tiingo API: <a class="reference external" href="https://api.tiingo.com/documentation/general/overview">https://api.tiingo.com/documentation/general/overview</a></p></li>
<li><p>íŒŒì´ì¬ íŒ¨í‚¤ì§€: <a class="github reference external" href="https://github.com/hydrosquall/tiingo-python">hydrosquall/tiingo-python</a></p></li>
</ul>
</section>
</section>
<section id="id4">
<h2><span class="section-number">11.2. </span>í‹°ì»¤ ìˆ˜ì§‘í•˜ê¸°<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>ì´ë²ˆì—ëŠ” í¬ë¡¤ë§ì„ í†µí•´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ë‹¤. ìš°ë¦¬ë‚˜ë¼ëŠ” í•œêµ­ê±°ë˜ì†Œë¥¼ í†µí•´ í‹°ì»¤ë¥¼ ì†ì‰½ê²Œ ìˆ˜ì§‘í•  ìˆ˜ ìˆì§€ë§Œ í•´ì™¸ì˜ ê²½ìš°ëŠ” ê·¸ë ‡ì§€ ì•Šë‹¤. ë¨¼ì € ìš°ë¦¬ë‚˜ë¼ì™€ ë‹¬ë¦¬ êµ­ê°€ ë³„ë¡œ ê±°ë˜ì†Œê°€ ì—¬ëŸ¬ê°œì¸ ê²½ìš°ë„ ìˆìœ¼ë©°, í™ˆí˜ì´ì§€ì— ìƒì¥ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ” ê²½ìš°ë„ ë§ê¸° ë•Œë¬¸ì´ë‹¤.</p>
<p>ë‹¤í–‰íˆ íˆ¬ììë“¤ì´ ë§ì´ ì°¸ì¡°í•˜ëŠ” ì‚¬ì´íŠ¸ì¸ ì¸ë² ìŠ¤íŒ…ë‹·ì»´(<a class="reference external" href="https://www.investing.com/">https://www.investing.com/</a>)ì—ì„œëŠ” ì „ ì„¸ê³„ ì£¼ì‹ ë° ê°ì¢… ê¸ˆìœµ ë°ì´í„°ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. ì´ ì¤‘ ìŠ¤í¬ë¦¬ë‹ ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ ê° êµ­ê°€ë³„ í‹°ì»¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤. ë¨¼ì € ì¸ë² ìŠ¤íŒ…ë‹·ì»´ì— ì ‘ì†í•œ í›„ [Markets â†’ Stocks â†’ Stock Screener]ì— ì ‘ì†í•œë‹¤.</p>
<figure class="align-default" id="screen">
<img alt="_images/screen.png" src="_images/screen.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.3 </span><span class="caption-text">ì¸ë² ìŠ¤íŒ…ë‹·ì»´ì˜ ì£¼ì‹ ìŠ¤í¬ë¦¬ë„ˆ</span><a class="headerlink" href="#screen" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>í˜ì´ì§€ë¥¼ ì ‘ì†í•˜ë©´ ë¯¸êµ­ ì¢…ëª©ë“¤ì´ ë‚˜íƒ€ë‚˜ë©°, URLì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://www.investing.com/stock-screener/?sp=country::5|sector::a|industry::a|equityType::a%3Ceq_market_cap;1
</pre></div>
</div>
<p>í•˜ë‹¨ì— í‘œë¡œ ë‚˜íƒ€ëŠ” ì •ë³´ ì¤‘ Symbolì´ í‹°ì»¤ì— í•´ë‹¹í•˜ë©°, ì´ë¥¼ í†µí•´ í‹°ì»¤ë¥¼ ì†ì‰½ê²Œ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤. ë‹¤ìŒìœ¼ë¡œ êµ­ê°€ë¥¼ Japan(ì¼ë³¸)ìœ¼ë¡œ ì„ íƒí•˜ê³ , Equity Typeì€ ORD(ë³´í†µì£¼)ë¥¼ ì„ íƒí•˜ì.</p>
<figure class="align-default" id="japan">
<img alt="_images/japan.png" src="_images/japan.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.4 </span><span class="caption-text">ì¼ë³¸ êµ­ê°€ ì„ íƒ</span><a class="headerlink" href="#japan" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>í•˜ë‹¨ì˜ í…Œì´ë¸”ì´ ì¼ë³¸ ì¢…ëª©ë“¤ë¡œ ë°”ë€Œë©° URL ì—­ì‹œ ë‹¤ìŒê³¼ ê°™ì´ ë°”ë€ë‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://www.investing.com/stock-screener/?sp=country::35|sector::a|industry::a|equityType::ORD%3Ceq_market_cap;1
</pre></div>
</div>
<p>ì¦‰ ê¸°ì¡´ URL ì¤‘ êµ­ê°€ì— í•´ë‹¹í•˜ëŠ” â€˜countryâ€™ ë¶€ë¶„ì´ 5ì—ì„œ 35ë¡œ, ì£¼ì‹ ì¢…ë¥˜ì— í•´ë‹¹í•˜ëŠ” â€˜equityTypeâ€™ ë¶€ë¶„ì´ aì—ì„œ ORDë¡œ ë³€ê²½ë˜ì—ˆë‹¤. í•´ë‹¹ í˜ì´ì§€ëŠ” ë™ì ìœ¼ë¡œ í˜ì´ì§€ê°€ ë°”ë€Œë¯€ë¡œ ì…€ë ˆë‹ˆì›€ì„ í†µí•´ í¬ë¡¤ë§ì„ í•´ì•¼í•œë‹¤. ì˜ˆì œë¡œ ë¯¸êµ­ì˜ ë³´í†µì£¼ ì „ì¢…ëª© ì •ë³´ë¥¼ í¬ë¡¤ë§ í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">webdriver_manager.chrome</span> <span class="kn">import</span> <span class="n">ChromeDriverManager</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">Service</span><span class="p">(</span><span class="n">ChromeDriverManager</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">()))</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.investing.com/stock-screener/?sp=country::5|sector::a|industry::a|equityType::ORD%3Ceq_market_cap;1&#39;</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple">
<li><p>ë¨¼ì € í¬ë¡¬ ë“œë¼ì´ë²„ë¥¼ ì„¤ì •í•œë‹¤.</p></li>
<li><p>ë¯¸êµ­ ë³´í†µì£¼ì— í•´ë‹¹í•˜ëŠ” URLì„ ì…ë ¥í•œë‹¤.</p></li>
<li><p>í•´ë‹¹ í˜ì´ì§€ë¥¼ ì—°ë‹¤.</p></li>
</ol>
<figure class="align-default" id="selenium-open">
<img alt="_images/selenium_open.png" src="_images/selenium_open.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.5 </span><span class="caption-text">ì…€ë ˆë‹ˆì›€ì„ ì´ìš©í•œ ìŠ¤í¬ë¦¬ë„ˆ ì ‘ì†</span><a class="headerlink" href="#selenium-open" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>ë‹¤ìŒìœ¼ë¡œ HTML ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">html</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>HTML ì •ë³´ì— í•´ë‹¹í•˜ëŠ” <code class="docutils literal notranslate"><span class="pre">driver.page_source</span></code>ë¥¼ BeautifulSoup ê°ì²´ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤. ì´ì œ ìš°ë¦¬ê°€ ì°¾ê³ ì í•˜ëŠ” ë°ì´í„°ë¥¼ í•˜ë‚˜ì”© ì‚´í´ë³´ë„ë¡ í•œë‹¤. ë¨¼ì € ê° êµ­ê°€ë³„ ì½”ë“œë¥¼ ì‚´í´ë³´ë„ë¡ í•˜ì. ê°œë°œìë„êµ¬ í™”ë©´ì—ì„œ â€˜newBtnDropdown noHoverâ€™ í´ë˜ìŠ¤ í•˜ë‹¨ì˜ â€˜li íƒœê·¸ì˜ â€˜data-valueâ€™ ì†ì„±ì„ ì‚´í´ë³´ë©´ êµ­ê°€ë³„ ì½”ë“œì™€ êµ­ê°€ëª…ì´ ì í˜€ìˆë‹¤.</p>
<figure class="align-default" id="country-ticker">
<img alt="_images/country_ticker.png" src="_images/country_ticker.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.6 </span><span class="caption-text">êµ­ê°€ë³„ ì½”ë“œ</span><a class="headerlink" href="#country-ticker" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>ì´ë²ˆì—ëŠ” ìœ„ì ¯ì—ì„œ ì„ íƒë˜ì–´ ìˆëŠ” êµ­ê°€ëª…ì„ í™•ì¸í•´ë³´ë„ë¡ í•˜ì. â€˜newBtnDropdown noHoverâ€™ í´ë˜ìŠ¤ í•˜ë‹¨ì˜ â€˜inputâ€™ íƒœê·¸ì˜ â€˜valueâ€™ ì†ì„±ì˜ ì†ì„±ëª…ì—ëŠ” êµ­ê°€ëª…ì´ ì í˜€ ìˆë‹¤. ì´ë¥¼ ì½”ë“œë¥¼ í†µí•´ ì°¾ì•„ë³´ë„ë¡ í•˜ì.</p>
<figure class="align-default" id="country-name">
<img alt="_images/country_name.png" src="_images/country_name.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.7 </span><span class="caption-text">êµ­ê°€ëª… í™•ì¸</span><a class="headerlink" href="#country-name" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;js-search-input inputDropDown&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;United States&#39;
</pre></div>
</div>
</div>
</div>
<p>ì´ë²ˆì—ëŠ” ì¢…ëª©ë“¤ì˜ ì •ë³´ê°€ ìˆëŠ” í…Œì´ë¸”ì„ í™•ì¸í•´ë³´ë„ë¡ í•˜ì. í´ë˜ìŠ¤ ëª…ì´ â€˜genTbl openTbl resultsStockScreenerTbl elpTblâ€™ ì¸ í…Œì´ë¸” ì¤‘ â€˜tbodyâ€™ ë¶€ë¶„ì— í•´ë‹¹ ë°ì´í„°ê°€ ìœ„ì¹˜í•˜ê³  ìˆë‹¤. ì´ ì •ë³´ë¥¼ ì´ìš©í•´ í•´ë‹¹ í…Œì´ë¸” ë°ì´í„°ë¥¼ ì„ íƒí•˜ì.</p>
<figure class="align-default" id="screen-table">
<img alt="_images/screen_table.png" src="_images/screen_table.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.8 </span><span class="caption-text">ì¢…ëª© í…Œì´ë¸”</span><a class="headerlink" href="#screen-table" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">html_table</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;table.genTbl.openTbl.resultsStockScreenerTbl.elpTbl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">html_table</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<figure class="align-default" id="selenium-1">
<img alt="_images/selenium_1.png" src="_images/selenium_1.png" />
</figure>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ table íƒœê·¸ ì¤‘ í•´ë‹¹ í´ë˜ìŠ¤ëª…ì„ ì°¾ì€ í›„ ì¶œë ¥í•˜ë©´, ì¢…ëª© ì •ë³´ë“¤ì´ ë‹´ê¸´ í…Œì´ë¸”ì˜ HTML ì •ë³´ê°€ ì¶œë ¥ëœë‹¤. ì´ì œ ì´ë¥¼ ë°ì´í„°í”„ë ˆì„ í˜•íƒœë¡œ ë³€í™˜í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">html_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
<span class="n">df_table_result</span> <span class="o">=</span> <span class="n">df_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">prettify()</span></code> ë©”ì„œë“œë¥¼ ì´ìš©í•´ BeautifulSoup ì—ì„œ íŒŒì‹±í•œ íŒŒì„œ íŠ¸ë¦¬ë¥¼ ìœ ë‹ˆì½”ë“œ í˜•íƒœë¡œ ë‹¤ì‹œ ëŒë ¤ì¤€ í›„, <code class="docutils literal notranslate"><span class="pre">read_html()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ í…Œì´ë¸”ì„ ì½ì–´ì˜¨ë‹¤. Variable Explorer ì°½ì—ì„œ df_table_result ë³€ìˆ˜ë¥¼ í™•ì¸í•´ë³´ì.</p>
<figure class="align-default" id="selenium-2">
<img alt="_images/selenium_2.png" src="_images/selenium_2.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.9 </span><span class="caption-text">í¬ë¡¤ë§ ê²°ê³¼ í™•ì¸</span><a class="headerlink" href="#selenium-2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>ê²°ê³¼ë¥¼ ì‚´í´ë³´ë©´ ì›¹í˜ì´ì§€ì— ìˆëŠ” ë‚´ì—­ ì™¸ì—ë„ Exchange(ê±°ë˜ì†Œ), Sector, Industy ë“± ì¶”ê°€ì ì¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì´ ì¤‘ í•„ìš”í•œ ì—´ë§Œ ì„ íƒí•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_table_select</span> <span class="o">=</span> <span class="n">df_table</span><span class="p">[</span><span class="mi">0</span><span class="p">][[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;Exchange&#39;</span><span class="p">,</span>  <span class="s1">&#39;Sector&#39;</span><span class="p">,</span> <span class="s1">&#39;Market Cap&#39;</span><span class="p">]]</span>
<span class="n">df_table_select</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Symbol</th>
      <th>Exchange</th>
      <th>Sector</th>
      <th>Market Cap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Apple</td>
      <td>AAPL</td>
      <td>NASDAQ</td>
      <td>Technology</td>
      <td>2.72T</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Microsoft</td>
      <td>MSFT</td>
      <td>NASDAQ</td>
      <td>Technology</td>
      <td>2.33T</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alphabet C</td>
      <td>GOOG</td>
      <td>NASDAQ</td>
      <td>Technology</td>
      <td>1.54T</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Alphabet A</td>
      <td>GOOGL</td>
      <td>NASDAQ</td>
      <td>Technology</td>
      <td>1.54T</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Amazon.com</td>
      <td>AMZN</td>
      <td>NASDAQ</td>
      <td>Consumer Cyclicals</td>
      <td>1.19T</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì¢…ëª© ì •ë³´ê°€ ëª‡í˜ì´ì§€ê¹Œì§€ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤. ì›¹í˜ì´ì§€ì˜ â€˜Screener Resultsâ€™ ê¸€ì ë’¤ì—ëŠ” í•´ë‹¹ êµ­ê°€ì— ì´ ëª‡ ì¢…ëª©ì´ ìˆëŠ”ì§€ ì¶œë ¥ëœë‹¤. í•œ í˜ì´ì§€ì—ëŠ” ì´ 50 ì¢…ëª©ì´ ì¶œë ¥ë˜ë¯€ë¡œ í•´ë‹¹ ìˆ«ìë¥¼ 50ìœ¼ë¡œ ë‚˜ëˆˆ í›„ ì˜¬ë¦¼ì„ í•˜ë©´ ì´ í˜ì´ì§€ ìˆ˜ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤. í•´ë‹¹ ì •ë³´ëŠ” â€˜js-total-resultsâ€™ í´ë˜ìŠ¤ì— ìœ„ì¹˜í•˜ê³  ìˆìœ¼ë©°, ì´ë¥¼ ì´ìš©í•´ í˜ì´ì§€ ìˆ˜ë¥¼ ê³„ì‚°í•´ë³´ë„ë¡ í•˜ì.</p>
<figure class="align-default" id="country-page">
<img alt="_images/country_page.png" src="_images/country_page.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.10 </span><span class="caption-text">ì¢…ëª© ìˆ˜ í™•ì¸</span><a class="headerlink" href="#country-page" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">end_num</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;js-total-results&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="nb">print</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">end_num</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>171
</pre></div>
</div>
</div>
</div>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ë“œë¼ì´ë¸Œë¡¤ ì¢…ë£Œí•´ì¤€ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="id5">
<h3><span class="section-number">11.2.1. </span>ì „ ì¢…ëª© í‹°ì»¤ í¬ë¡¤ë§<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<p>ìœ„ ê³¼ì •ì„ í†µí•´ êµ­ê°€ë³„ ì „ ì¢…ëª©ì˜ í‹°ì»¤ ë° ê´€ë ¨ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ê³¼, í˜ì´ì§€ ìˆ˜ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆì—ˆë‹¤. ì´ì œ forë¬¸ì„ ì´ìš©í•´ ë¯¸êµ­ì˜ ì „ ì¢…ëª© í‹°ì»¤ë¥¼ í¬ë¡¤ë§í•´ë³´ë„ë¡ í•˜ê² ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">webdriver_manager.chrome</span> <span class="kn">import</span> <span class="n">ChromeDriverManager</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">Service</span><span class="p">(</span><span class="n">ChromeDriverManager</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">()))</span>
<span class="n">nationcode</span> <span class="o">=</span> <span class="s1">&#39;5&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;https://investing.com/stock-screener/?sp=country::</span>
<span class="si">{</span><span class="n">nationcode</span><span class="si">}</span><span class="s1">|sector::a|industry::a|equityType::ORD%3Ceq_market_cap;1&#39;&#39;&#39;</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">(</span>
    <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;resultsTable&quot;]/tbody&#39;</span><span class="p">)))</span>

<span class="n">end_num</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;js-total-results&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="n">end_num</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">end_num</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple">
<li><p>í¬ë¡¬ ë“œë¼ì´ë¸Œë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.</p></li>
<li><p>êµ­ê°€ ì½”ë“œëŠ” ë¯¸êµ­ì— í•´ë‹¹í•˜ëŠ” â€˜5â€™ë¥¼ ì…ë ¥í•œë‹¤.</p></li>
<li><p>ë¨¼ì € ì²«í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” URLì„ ìƒì„±í•œë‹¤.</p></li>
<li><p>ì…€ë ˆë‹ˆì›€ìœ¼ë¡œ í•´ë‹¹ í˜ì´ì§€ë¥¼ ì—°ë‹¤</p></li>
<li><p>â€˜Screener Resultsâ€™ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì€ ì¢…ëª©ì´ ë“¤ì–´ìˆëŠ” í…Œì´ë¸”ì´ ë¡œë”©ëœ ì´í›„ ë‚˜íƒ€ë‚œë‹¤. ë”°ë¼ì„œ <code class="docutils literal notranslate"><span class="pre">WebDriverWait()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ í•´ë‹¹ í…Œì´ë¸”ì´ ë¡œë”©ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë©°, í…Œì´ë¸”ì˜ XPATHëŠ” â€˜//*[&#64;id=â€resultsTableâ€]/tbodyâ€™ ì´ë‹¤.</p></li>
<li><p>ì¢…ëª©ìˆ˜ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ í¬ë¡¤ë§í•œ í›„, ì´ë¥¼ í†µí•´ í˜ì´ì§€ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤.</p></li>
</ol>
<p>ì´ì œ forë¬¸ì„ í†µí•´ ëª¨ë“  í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ í¬ë¡¤ë§í•´ë³´ë„ë¡ í•˜ì.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_data_df</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">end_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>

    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;https://investing.com/stock-screener/?sp=country::</span>
<span class="s1">        </span><span class="si">{</span><span class="n">nationcode</span><span class="si">}</span><span class="s1">|sector::a|industry::a|equityType::ORD%3Ceq_market_cap;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;&#39;&#39;</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">(</span>
            <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;resultsTable&quot;]/tbody&#39;</span><span class="p">)))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">(</span>
            <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;resultsTable&quot;]/tbody&#39;</span><span class="p">)))</span>

    <span class="n">html</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>

    <span class="n">html_table</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s1">&#39;table.genTbl.openTbl.resultsStockScreenerTbl.elpTbl&#39;</span><span class="p">)</span>
    <span class="n">df_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">html_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">df_table_select</span> <span class="o">=</span> <span class="n">df_table</span><span class="p">[</span><span class="mi">0</span><span class="p">][[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Symbol&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Exchange&#39;</span><span class="p">,</span>  <span class="s1">&#39;Sector&#39;</span><span class="p">,</span> <span class="s1">&#39;Market Cap&#39;</span><span class="p">]]</span>

    <span class="n">all_data_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_table_select</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_data_df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">data_country</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;js-search-input inputDropDown&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="n">all_data_df_bind</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_country</span>
<span class="n">all_data_df_bind</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="p">[</span><span class="o">~</span><span class="n">all_data_df_bind</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="p">[</span><span class="n">all_data_df_bind</span><span class="p">[</span><span class="s1">&#39;Exchange&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;NASDAQ&#39;</span><span class="p">,</span> <span class="s1">&#39;NYSE&#39;</span><span class="p">,</span> <span class="s1">&#39;NYSE Amex&#39;</span><span class="p">])]</span>
<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;Symbol&#39;</span><span class="p">])</span>
<span class="n">all_data_df_bind</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">all_data_df_bind</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

<span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple">
<li><p>ë¹ˆ ë¦¬ìŠ¤íŠ¸(all_data_df)ë¥¼ ìƒì„±í•œë‹¤.</p></li>
<li><p>forë¬¸ì„ í†µí•´ ì „ì²´ í˜ì´ì§€ì—ì„œ ì¢…ëª©ëª…ê³¼ í‹°ì»¤ ë“±ì˜ ì •ë³´ë¥¼ í¬ë¡¤ë§í•œë‹¤.</p></li>
<li><p>f-stringì„ í†µí•´ ê° í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” URLì„ ìƒì„±í•œ í›„ í˜ì´ì§€ë¥¼ ì—°ë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WebDriverWait()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ í…Œì´ë¸”ì´ ë¡œë”©ë ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. ë˜í•œ ê°„í˜¹ í˜ì´ì§€ ì˜¤ë¥˜ê°€ ë°œìƒí•  ë•Œê°€ ìˆìœ¼ë¯€ë¡œ, try exceptë¬¸ì„ ì´ìš©í•´ ì˜¤ë¥˜ ë°œìƒ ì‹œ 1ì´ˆê°„ ê¸°ë‹¤ë¦° í›„ <code class="docutils literal notranslate"><span class="pre">refresh()</span></code>ë¥¼ í†µí•´ ìƒˆë¡œê³ ì¹¨ì„ í•˜ì—¬ ë‹¤ì‹œ í…Œì´ë¸”ì´ ë¡œë”©ë˜ê¸¸ ê¸°ë‹¤ë¦°ë‹¤.</p></li>
<li><p>HTML ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¨ í›„, í…Œì´ë¸”ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ ì„ íƒí•œë‹¤.</p></li>
<li><p>ì›í•˜ëŠ” ì—´ë§Œ ì„ íƒí•œë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">append()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ í•´ë‹¹ í…Œì´ë¸”ì„ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•œë‹¤.</p></li>
<li><p>2ì´ˆê°€ ì¼ì‹œì •ì§€ë¥¼ í•œë‹¤.</p></li>
<li><p>forë¬¸ì´ ëë‚˜ë©´ <code class="docutils literal notranslate"><span class="pre">concat()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ ë¦¬ìŠ¤íŠ¸ ë‚´ ëª¨ë“  ë°ì´í„°í”„ë ˆì„ì„ í–‰ìœ¼ë¡œ ë¬¶ì–´ì¤€ë‹¤.</p></li>
<li><p>êµ­ê°€ëª…ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ ì¶”ì¶œí•œ ë’¤, â€˜countryâ€™ ì—´ì— ì…ë ¥í•œë‹¤.</p></li>
<li><p>â€˜dateâ€™ ì—´ì— ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ì…ë ¥í•œë‹¤.</p></li>
<li><p>ì¼ë¶€ ì¢…ëª©ì˜ ê²½ìš° ì¢…ëª©ëª…ì´ ë¹ˆì¹¸ìœ¼ë¡œ ë“¤ì–´ì˜¤ë¯€ë¡œ ì´ë¥¼ ì œê±°í•œë‹¤.</p></li>
<li><p>â€˜Exchangeâ€™ ì—´ì—ì„œ ê±°ë˜ê°€ ê°€ëŠ¥í•œ ê±°ë˜ì†Œë§Œ ì„ íƒí•œë‹¤.</p></li>
<li><p>ì¼ë¶€ ì¢…ëª©ì˜ ê²½ìš° ì¤‘ë³µëœ ê²°ê³¼ê°€ ë“¤ì–´ì˜¤ê¸°ë„ í•˜ë¯€ë¡œ <code class="docutils literal notranslate"><span class="pre">drop_duplicates()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ Symbolì´ ê²¹ì¹˜ëŠ” ê²½ìš° í•œê°œë§Œ ë‚¨ê²¨ì¤€ë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reset_index()</span></code> ë©”ì„œë“œë¥¼ í†µí•´ ì¸ë±ìŠ¤ë¥¼ ì´ˆê¸°í™”í•œë‹¤.</p></li>
<li><p>nanì„ Noneìœ¼ë¡œ ë³€ê²½í•œë‹¤.</p></li>
<li><p>ë“œë¼ì´ë¸Œë¡¤ ì¢…ë£Œí•œë‹¤.</p></li>
</ol>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ ìœ„ ë°ì´í„°í”„ë ˆì„ì„ SQLì— ì €ì¥í•´ì£¼ë„ë¡ í•œë‹¤. ë¨¼ì € SQLì—ì„œ ë‹¤ìŒì˜ ì¿¼ë¦¬ë¥¼ í†µí•´ í…Œì´ë¸”(global_ticker)ì„ ë§Œë“ ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>use stock_db;

create table global_ticker
(
    Name varchar(50) not null,
    Symbol varchar(30),
    Exchange varchar(30),
    Sector varchar(30),
    `Market Cap` varchar(10),
    country varchar(20),    
    date date,
    primary key(Symbol, country, date)
);
</pre></div>
</div>
</div>
</div>
<p>ìœ„ì—ì„œ êµ¬í•œ í‹°ì»¤ ë°ì´í„°ë¥¼ í•´ë‹¹ í…Œì´ë¸”ì— ì €ì¥í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymysql</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                      <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span>
                      <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                      <span class="n">db</span><span class="o">=</span><span class="s1">&#39;stock_db&#39;</span><span class="p">,</span>
                      <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>

<span class="n">mycursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    insert into global_ticker (Name, Symbol, Exchange, Sector, `Market Cap`, country, date)</span>
<span class="s2">    values (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">) as new</span>
<span class="s2">    on duplicate key update</span>
<span class="s2">    name=new.name,Exchange=new.Exchange,Sector=new.Sector,</span>
<span class="s2">    `Market Cap`=new.`Market Cap`; </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">all_data_df_bind</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">mycursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<figure class="align-default" id="ticker-sql">
<img alt="_images/ticker_sql.png" src="_images/ticker_sql.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.11 </span><span class="caption-text">ê¸€ë¡œë²Œ í‹°ì»¤ í…Œì´ë¸”</span><a class="headerlink" href="#ticker-sql" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>nationcode ë¶€ë¶„ë§Œ ë³€ê²½í•˜ë©´ ëª¨ë“  êµ­ê°€ì˜ í‹°ì»¤ ë¦¬ìŠ¤íŠ¸ ì—­ì‹œ ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆë‹¤.</p></li>
</ul>
</div>
</section>
</section>
<section id="id6">
<h2><span class="section-number">11.3. </span>ì£¼ê°€ ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<p>ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œëŠ” ì „ ì„¸ê³„ ì£¼ê°€(í•œêµ­ í¬í•¨)ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">finance</span><span class="o">.</span><span class="n">yahoo</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
</pre></div>
</div>
<p>ì‚¬ì´íŠ¸ì—ì„œ ì¢…ëª© í‹°ì»¤ë¥¼ ê²€ìƒ‰í•œ í›„ [Historical Data] íƒ­ì„ ì„ íƒí•˜ë©´ í™•ì¸ ë° ë‹¤ìš´ë¡œë“œê°€ ê°€ëŠ¥í•˜ë‹¤. ë˜í•œ ì•¼í›„ APIë¥¼ í†µí•´ í•´ë‹¹ ë°ì´í„°ë¥¼ ì†ì‰½ê²Œ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆëŠ” íŒ¨í‚¤ì§€ë“¤ì´ ìˆìœ¼ë¯€ë¡œ, ì´ë¥¼ ì´ìš©í•´ ë¨¼ì € ì• í”Œ(AAPL)ì˜ ì£¼ê°€ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ì•„ë³´ë„ë¡ í•˜ì.</p>
<figure class="align-default" id="yahoo-price">
<img alt="_images/yahoo_price.png" src="_images/yahoo_price.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.12 </span><span class="caption-text">ì•¼í›„ì—ì„œ ì œê³µí•˜ëŠ” ì£¼ê°€ ë°ì´í„°</span><a class="headerlink" href="#yahoo-price" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>

<span class="n">price</span> <span class="o">=</span>  <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[*********************100%***********************]  1 of 1 completed
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1980-12-12</th>
      <td>0.128348</td>
      <td>0.128906</td>
      <td>0.128348</td>
      <td>0.128348</td>
      <td>0.099584</td>
      <td>469033600</td>
    </tr>
    <tr>
      <th>1980-12-15</th>
      <td>0.122210</td>
      <td>0.122210</td>
      <td>0.121652</td>
      <td>0.121652</td>
      <td>0.094388</td>
      <td>175884800</td>
    </tr>
    <tr>
      <th>1980-12-16</th>
      <td>0.113281</td>
      <td>0.113281</td>
      <td>0.112723</td>
      <td>0.112723</td>
      <td>0.087461</td>
      <td>105728000</td>
    </tr>
    <tr>
      <th>1980-12-17</th>
      <td>0.115513</td>
      <td>0.116071</td>
      <td>0.115513</td>
      <td>0.115513</td>
      <td>0.089625</td>
      <td>86441600</td>
    </tr>
    <tr>
      <th>1980-12-18</th>
      <td>0.118862</td>
      <td>0.119420</td>
      <td>0.118862</td>
      <td>0.118862</td>
      <td>0.092224</td>
      <td>73449600</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>yfinance íŒ¨í‚¤ì§€ì˜ <code class="docutils literal notranslate"><span class="pre">download()</span></code> í•¨ìˆ˜ ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´ ì£¼ê°€ ì •ë³´ë¥¼ ë§¤ìš° ì†ì‰½ê²Œ ë°›ì„ ìˆ˜ ìˆë‹¤. [1 of 1 completed] ë¶€ë¶„ì— í•´ë‹¹í•˜ëŠ” ì§„í–‰ê³¼ì •ì„ ì¶œë ¥í•˜ê³  ì‹¶ì§€ ì•Šì„ ì‹œ, <code class="docutils literal notranslate"><span class="pre">progress=False</span></code> ì¸ìë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="n">progress</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">start</span></code> ì¸ìë¥¼ ì¶”ê°€í•˜ë©´ ë°ì´í„° ë‹¤ìš´ë¡œë“œ ê¸°ê°„ì„ ë³€ê²½í•  ìˆ˜ë„ ìˆë‹¤. 2000ë…„ 1ì›” 1ì¼ë¶€í„° ë°ì´í„°ë¥¼ ë°›ëŠ”ë²•ì€ ë‹¤ìŒê°€ ê°™ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="s1">&#39;2000-01-01&#39;</span><span class="p">,</span> <span class="n">progress</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">price</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-03</th>
      <td>0.936384</td>
      <td>1.004464</td>
      <td>0.907924</td>
      <td>0.999442</td>
      <td>0.849468</td>
      <td>535796800</td>
    </tr>
    <tr>
      <th>2000-01-04</th>
      <td>0.966518</td>
      <td>0.987723</td>
      <td>0.903460</td>
      <td>0.915179</td>
      <td>0.777850</td>
      <td>512377600</td>
    </tr>
    <tr>
      <th>2000-01-05</th>
      <td>0.926339</td>
      <td>0.987165</td>
      <td>0.919643</td>
      <td>0.928571</td>
      <td>0.789232</td>
      <td>778321600</td>
    </tr>
    <tr>
      <th>2000-01-06</th>
      <td>0.947545</td>
      <td>0.955357</td>
      <td>0.848214</td>
      <td>0.848214</td>
      <td>0.720933</td>
      <td>767972800</td>
    </tr>
    <tr>
      <th>2000-01-07</th>
      <td>0.861607</td>
      <td>0.901786</td>
      <td>0.852679</td>
      <td>0.888393</td>
      <td>0.755083</td>
      <td>460734400</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>ë¯¸êµ­ì´ ì•„ë‹Œ êµ­ê°€ì˜ ê²½ìš° ë‹¨ìˆœíˆ í‹°ì»¤ë§Œ ì…ë ¥í•  ê²½ìš° ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ì—†ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì¼ë³¸ì˜ â€˜ë„ì¿„ ì¼ë ‰íŠ¸ë¡ â€™ì€ ì¼ë³¸ ë‚´ì—ì„œ í‹°ì»¤ê°€ â€˜8035â€™ì´ë©°, ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œ ì´ë¥¼ ê²€ìƒ‰í•´ë³´ì.</p>
<figure class="align-default" id="same-ticker">
<img alt="_images/same_ticker.png" src="_images/same_ticker.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.13 </span><span class="caption-text">ì¤‘ë³µ í‹°ì»¤</span><a class="headerlink" href="#same-ticker" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë„ì¿„ ì¼ë ‰íŠ¸ë¡  ë¿ë§Œ ì•„ë‹ˆë¼ í™ì½©ì— ìƒì¥ëœ â€˜Janco Holdings Limitedâ€™ë¼ëŠ” ì£¼ì‹ ì—­ì‹œ í‹°ì»¤ê°€ 8035 ì´ë‹¤. ì´ì²˜ëŸ¼ ê°ê¸° ë‹¤ë¥¸ êµ­ê°€ì—ì„œ ì¤‘ë³µëœ í‹°ì»¤ê°€ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ì¢…ì¢… ë°œìƒë˜ë¯€ë¡œ, ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ í˜¹ì€ ì—¬ëŸ¬ ë²¤ë”ì˜ ê²½ìš° â€˜í‹°ì»¤.êµ­ê°€ì½”ë“œâ€™ í˜•íƒœë¥¼ í†µí•´ ì´ë“¤ì„ êµ¬ë¶„í•œë‹¤. ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œ ì¼ë³¸ì˜ êµ­ê°€ì½”ë“œëŠ” â€˜Tâ€™ ì´ë‹¤. ì´ë¥¼ ì´ìš©í•´ ë„ì¿„ ì¼ë ‰íŠ¸ë¡ ì˜ ì£¼ê°€ë¥¼ ë°›ëŠ” ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;8035.T&quot;</span><span class="p">,</span> <span class="n">progress</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">price</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-04</th>
      <td>13800.0</td>
      <td>14000.0</td>
      <td>12890.0</td>
      <td>13010.0</td>
      <td>11311.805664</td>
      <td>231000</td>
    </tr>
    <tr>
      <th>2000-01-05</th>
      <td>11510.0</td>
      <td>12140.0</td>
      <td>11020.0</td>
      <td>11950.0</td>
      <td>10390.168945</td>
      <td>672000</td>
    </tr>
    <tr>
      <th>2000-01-06</th>
      <td>12000.0</td>
      <td>12600.0</td>
      <td>11000.0</td>
      <td>11020.0</td>
      <td>9581.561523</td>
      <td>688000</td>
    </tr>
    <tr>
      <th>2000-01-07</th>
      <td>10800.0</td>
      <td>11530.0</td>
      <td>10530.0</td>
      <td>10920.0</td>
      <td>9494.613281</td>
      <td>1203000</td>
    </tr>
    <tr>
      <th>2000-01-10</th>
      <td>10920.0</td>
      <td>10920.0</td>
      <td>10920.0</td>
      <td>10920.0</td>
      <td>9494.613281</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>ë¯¸êµ­ì˜ ê²½ìš°ëŠ” êµ­ê°€ì½”ë“œê°€ í•„ìš”ì—†ì´ ë‹¨ìˆœíˆ í‹°ì»¤ë§Œ ì…ë ¥í•˜ë©´ ëœë‹¤.</p></li>
<li><p>êµ­ë‚´ ì£¼ê°€ ì—­ì‹œ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ë¥¼ í†µí•´ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¼ë¶€ ì¤‘ì†Œí˜•ì£¼ì˜ ê²½ìš° ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì–´ êµ­ë‚´ ì‚¬ì´íŠ¸ë¥¼ ì´ìš©í•´ ìˆ˜ì§‘í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.</p></li>
</ul>
</div>
<section id="id7">
<h3><span class="section-number">11.3.1. </span>ì „ ì¢…ëª© ì£¼ê°€ ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<p>ë¯¸êµ­ ë°ì´í„° ì—­ì‹œ êµ­ë‚´ ì „ì¢…ëª© ì£¼ê°€ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ê³  DBì— ì €ì¥í–ˆë˜ê²ƒê³¼ ë™ì¼í•˜ê²Œ forë¬¸ì„ ì´ìš©í•˜ë©´ ëœë‹¤. ë¨¼ì € SQLì—ì„œ ì£¼ê°€ ë°ì´í„°ì— í•´ë‹¹í•˜ëŠ” í…Œì´ë¸”(global_price)ë¥¼ ë§Œë“ ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>use stock_db;

create table global_price
(
    Date date,
    High double,
    Low double,
    Open double,
    Close double,
    Volume double,
    `Adj Close` double,
    ticker varchar(20),
    primary key(Date, ticker)
);
</pre></div>
</div>
</div>
</div>
<p>íŒŒì´ì¬ì—ì„œ ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ forë¬¸ì„ í†µí•´ ì „ì¢…ëª© ì£¼ê°€ê°€ DBì— ì €ì¥ëœë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># íŒ¨í‚¤ì§€ ë¶ˆëŸ¬ì˜¤ê¸°</span>
<span class="kn">import</span> <span class="nn">pymysql</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1"># DB ì—°ê²°</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;mysql+pymysql://root:1234@127.0.0.1:3306/stock_db&#39;</span><span class="p">)</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                      <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span>
                      <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                      <span class="n">db</span><span class="o">=</span><span class="s1">&#39;stock_db&#39;</span><span class="p">,</span>
                      <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>

<span class="n">mycursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># í‹°ì»¤ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</span>
<span class="n">ticker_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select * from global_ticker</span>
<span class="s2">where date = (select max(date) from global_ticker)</span>
<span class="s2">and country = &#39;United States&#39;;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="c1"># DB ì €ì¥ ì¿¼ë¦¬</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    insert into global_price (Date, High, Low, Open, Close, Volume, `Adj Close`, ticker)</span>
<span class="s2">    values (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">) as new</span>
<span class="s2">    on duplicate key update</span>
<span class="s2">    High = new.High, Low = new.Low, Open = new.Open, Close = new.Close,</span>
<span class="s2">    Volume = new.Volume, `Adj Close` = new.`Adj Close`;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># ì˜¤ë¥˜ ë°œìƒì‹œ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸ ìƒì„±</span>
<span class="n">error_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># ì „ì¢…ëª© ì£¼ê°€ ë‹¤ìš´ë¡œë“œ ë° ì €ì¥</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticker_list</span><span class="p">))):</span>

    <span class="c1"># í‹°ì»¤ ì„ íƒ</span>
    <span class="n">ticker</span> <span class="o">=</span> <span class="n">ticker_list</span><span class="p">[</span><span class="s1">&#39;Symbol&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># ì˜¤ë¥˜ ë°œìƒ ì‹œ ì´ë¥¼ ë¬´ì‹œí•˜ê³  ë‹¤ìŒ ë£¨í”„ë¡œ ì§„í–‰</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="c1"># ì£¼ê°€ ë‹¤ìš´ë¡œë“œ</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># ë°ì´í„° í´ë Œì§•</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">price</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ticker</span>

        <span class="c1"># ì£¼ê°€ ë°ì´í„°ë¥¼ DBì— ì €ì¥</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">mycursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">except</span><span class="p">:</span>

        <span class="c1"># ì˜¤ë¥˜ ë°œìƒì‹œ error_listì— í‹°ì»¤ ì €ì¥í•˜ê³  ë„˜ì–´ê°€ê¸°</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

    <span class="c1"># íƒ€ì„ìŠ¬ë¦½ ì ìš©</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># DB ì—°ê²° ì¢…ë£Œ</span>
<span class="n">engine</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple">
<li><p>DBì— ì—°ê²°í•œë‹¤.</p></li>
<li><p>ê¸°ì¤€ì¼ì´ ìµœëŒ€, ì¦‰ ìµœê·¼ì¼ ê¸°ì¤€ ë³´í†µì£¼ì— í•´ë‹¹í•˜ë©°, ë¯¸êµ­ ì¢…ëª©ì˜ ë¦¬ìŠ¤íŠ¸(ticker_list)ë§Œ ë¶ˆëŸ¬ì˜¨ë‹¤.</p></li>
<li><p>DBì— ì €ì¥í•  ì¿¼ë¦¬(query)ë¥¼ ì…ë ¥í•œë‹¤.</p></li>
<li><p>í˜ì´ì§€ ì˜¤ë¥˜, í†µì‹  ì˜¤ë¥˜ ë“± ì˜¤ë¥˜ê°€ ë°œìƒí•œ í‹°ì»¤ëª…ì„ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸(error_list)ë¥¼ ë§Œë“ ë‹¤.</p></li>
<li><p>forë¬¸ì„ í†µí•´ ì „ì¢…ëª© ì£¼ê°€ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ìœ¼ë©°, ì§„í–‰ìƒí™©ì„ ì•Œê¸°ìœ„í•´ <code class="docutils literal notranslate"><span class="pre">tqdm()</span></code> í•¨ìˆ˜ë¥¼ ì´ìš©í•œë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">download()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œ ì£¼ê°€ë¥¼ ë°›ì€ í›„ í´ë Œì§• ì²˜ë¦¬í•œë‹¤. ê·¸ í›„ ì£¼ê°€ ë°ì´í„°ë¥¼ DBì— ì €ì¥í•œë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">try</span> <span class="pre">except</span></code>ë¬¸ì„ í†µí•´ ì˜¤ë¥˜ê°€ ë°œìƒì‹œ â€˜error_listâ€™ì— í‹°ì»¤ë¥¼ ì €ì¥í•œë‹¤.</p></li>
<li><p>ë¬´í•œ í¬ë¡¤ë§ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ í•œ ë²ˆì˜ ë£¨í”„ê°€ ëë‚  ë•Œë§ˆë‹¤ íƒ€ì„ìŠ¬ë¦½ì„ ì ìš©í•œë‹¤.</p></li>
<li><p>ëª¨ë“  ì‘ì—…ì´ ëë‚˜ë©´ DBì™€ì˜ ì—°ê²°ì„ ì¢…ë£Œí•œë‹¤.</p></li>
</ol>
<figure class="align-default" id="sql-price">
<img alt="_images/sql_price.png" src="_images/sql_price.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.14 </span><span class="caption-text">ê¸€ë¡œë²Œ ì£¼ê°€ í…Œì´ë¸”</span><a class="headerlink" href="#sql-price" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>ì‘ì—…ì´ ì¢…ë£Œëœ í›„ â€˜error_listâ€™ì—ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•´ ë‹¤ìš´ë¡œë“œ ë°›ì§€ ëª»í•œ ì¢…ëª©ë“¤ì´ ì…ë ¥ë˜ì–´ ìˆë‹¤. ì´ëŠ” í˜ì´ì§€ ì˜¤ë¥˜ë‚˜ í†µì‹  ì˜¤ë¥˜ ë•Œë¬¸ì¼ ìˆ˜ë„ ìˆìœ¼ë©°, ì¸ë² ìŠ¤íŒ…ë‹·ì»´ì—ëŠ” ì¡´ì¬í•˜ì§€ë§Œ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¢…ëª©ì¼ ìˆ˜ë„ ìˆë‹¤.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ë¯¸êµ­ì´ ì•„ë‹Œ íƒ€ êµ­ê°€ì˜ ê²½ìš° í‹°ì»¤ì˜ ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ticker ì—´ì— êµ­ê°€ì½”ë“œë„ í•¨ê»˜ ì…ë ¥í•œ í›„ DBì— ì €ì¥í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.</p>
</div>
</section>
</section>
<section id="id8">
<h2><span class="section-number">11.4. </span>ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h2>
<p>ì¬ë¬´ì œí‘œ ì—­ì‹œ ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ì—ì„œ êµ¬í•  ìˆ˜ ìˆìœ¼ë©°, [Financials] íƒ­ì„ í´ë¦­í•˜ë©´ ì—°ê°„ ë° ë¶„ê¸° ê¸°ì¤€ ì¬ë¬´ì œí‘œë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. í•´ë‹¹ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ íŒ¨í‚¤ì§€ê°€ ì¡´ì¬í•˜ë©°, ë³¸ ì±…ì—ì„œëŠ” ê·¸ ì¤‘ì—ì„œ yahooquery íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ë‹¤. í•´ë‹¹ íŒ¨í‚¤ì§€ì˜ ìì„¸í•œ ì„¤ëª…ì€ ì•„ë˜ ì‚¬ì´íŠ¸ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì˜ˆì‹œë¡œ ì• í”Œ(AAPL)ì˜ ì¢…ëª©ì •ë³´ ë° ì¬ë¬´ì œí‘œë¥¼ ë°›ì•„ë³´ë„ë¡ í•˜ê² ë‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">yahooquery</span><span class="o">.</span><span class="n">dpguthrie</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
</pre></div>
</div>
<figure class="align-default" id="yahoo-fs">
<img alt="_images/yahoo_fs.png" src="_images/yahoo_fs.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.15 </span><span class="caption-text">ì•¼í›„ì—ì„œ ì œê³µí•˜ëŠ” ì¬ë¬´ì œí‘œ ë°ì´í„°</span><a class="headerlink" href="#yahoo-fs" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yahooquery</span> <span class="kn">import</span> <span class="n">Ticker</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Ticker</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">asset_profile</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;AAPL&#39;: {&#39;address1&#39;: &#39;One Apple Park Way&#39;,
  &#39;city&#39;: &#39;Cupertino&#39;,
  &#39;state&#39;: &#39;CA&#39;,
  &#39;zip&#39;: &#39;95014&#39;,
  &#39;country&#39;: &#39;United States&#39;,
  &#39;phone&#39;: &#39;408 996 1010&#39;,
  &#39;website&#39;: &#39;https://www.apple.com&#39;,
  &#39;industry&#39;: &#39;Consumer Electronics&#39;,
  &#39;industryDisp&#39;: &#39;Consumer Electronics&#39;,
  &#39;sector&#39;: &#39;Technology&#39;,
  &#39;longBusinessSummary&#39;: &#39;Apple Inc. designs, manufactures, and markets smartphones, personal computers, tablets, wearables, and accessories worldwide. The company offers iPhone, a line of smartphones; Mac, a line of personal computers; iPad, a line of multi-purpose tablets; and wearables, home, and accessories comprising AirPods, Apple TV, Apple Watch, Beats products, and HomePod. It also provides AppleCare support and cloud services; and operates various platforms, including the App Store that allow customers to discover and download applications and digital content, such as books, music, video, games, and podcasts. In addition, the company offers various services, such as Apple Arcade, a game subscription service; Apple Fitness+, a personalized fitness service; Apple Music, which offers users a curated listening experience with on-demand radio stations; Apple News+, a subscription news and magazine service; Apple TV+, which offers exclusive original content; Apple Card, a co-branded credit card; and Apple Pay, a cashless payment service, as well as licenses its intellectual property. The company serves consumers, and small and mid-sized businesses; and the education, enterprise, and government markets. It distributes third-party applications for its products through the App Store. The company also sells its products through its retail and online stores, and direct sales force; and third-party cellular network carriers, wholesalers, retailers, and resellers. Apple Inc. was incorporated in 1977 and is headquartered in Cupertino, California.&#39;,
  &#39;fullTimeEmployees&#39;: 164000,
  &#39;companyOfficers&#39;: [{&#39;maxAge&#39;: 1,
    &#39;name&#39;: &#39;Mr. Timothy D. Cook&#39;,
    &#39;age&#39;: 61,
    &#39;title&#39;: &#39;CEO &amp; Director&#39;,
    &#39;yearBorn&#39;: 1961,
    &#39;fiscalYear&#39;: 2022,
    &#39;totalPay&#39;: 16425933,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0},
   {&#39;maxAge&#39;: 1,
    &#39;name&#39;: &#39;Mr. Luca  Maestri&#39;,
    &#39;age&#39;: 59,
    &#39;title&#39;: &#39;CFO &amp; Sr. VP&#39;,
    &#39;yearBorn&#39;: 1963,
    &#39;fiscalYear&#39;: 2022,
    &#39;totalPay&#39;: 5019783,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0},
   {&#39;maxAge&#39;: 1,
    &#39;name&#39;: &#39;Mr. Jeffrey E. Williams&#39;,
    &#39;age&#39;: 58,
    &#39;title&#39;: &#39;Chief Operating Officer&#39;,
    &#39;yearBorn&#39;: 1964,
    &#39;fiscalYear&#39;: 2022,
    &#39;totalPay&#39;: 5018337,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0},
   {&#39;maxAge&#39;: 1,
    &#39;name&#39;: &#39;Ms. Katherine L. Adams&#39;,
    &#39;age&#39;: 58,
    &#39;title&#39;: &#39;Sr. VP, Gen. Counsel &amp; Sec.&#39;,
    &#39;yearBorn&#39;: 1964,
    &#39;fiscalYear&#39;: 2022,
    &#39;totalPay&#39;: 5015208,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0},
   {&#39;maxAge&#39;: 1,
    &#39;name&#39;: &quot;Ms. Deirdre  O&#39;Brien&quot;,
    &#39;age&#39;: 55,
    &#39;title&#39;: &#39;Sr. VP of Retail&#39;,
    &#39;yearBorn&#39;: 1967,
    &#39;fiscalYear&#39;: 2022,
    &#39;totalPay&#39;: 5019783,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0},
   {&#39;maxAge&#39;: 1,
    &#39;name&#39;: &#39;Mr. Chris  Kondo&#39;,
    &#39;title&#39;: &#39;Sr. Director of Corp. Accounting&#39;,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0},
   {&#39;maxAge&#39;: 1,
    &#39;name&#39;: &#39;Mr. James  Wilson&#39;,
    &#39;title&#39;: &#39;Chief Technology Officer&#39;,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0},
   {&#39;maxAge&#39;: 1,
    &#39;name&#39;: &#39;Ms. Mary  Demby&#39;,
    &#39;title&#39;: &#39;Chief Information Officer&#39;,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0},
   {&#39;maxAge&#39;: 1,
    &#39;name&#39;: &#39;Ms. Nancy  Paxton&#39;,
    &#39;title&#39;: &#39;Sr. Director of Investor Relations &amp; Treasury&#39;,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0},
   {&#39;maxAge&#39;: 1,
    &#39;name&#39;: &#39;Mr. Greg  Joswiak&#39;,
    &#39;title&#39;: &#39;Sr. VP of Worldwide Marketing&#39;,
    &#39;exercisedValue&#39;: 0,
    &#39;unexercisedValue&#39;: 0}],
  &#39;auditRisk&#39;: 4,
  &#39;boardRisk&#39;: 1,
  &#39;compensationRisk&#39;: 5,
  &#39;shareHolderRightsRisk&#39;: 1,
  &#39;overallRisk&#39;: 1,
  &#39;governanceEpochDate&#39;: &#39;2023-05-01 09:00:00&#39;,
  &#39;compensationAsOfEpochDate&#39;: &#39;2022-12-31 09:00:00&#39;,
  &#39;maxAge&#39;: 86400}}
</pre></div>
</div>
</div>
</div>
<p>yahooquery íŒ¨í‚¤ì§€ì˜ <code class="docutils literal notranslate"><span class="pre">Ticker()</span></code> í•¨ìˆ˜ë‚´ì— í‹°ì»¤ë¥¼ ì…ë ¥í•˜ë©´, í•´ë‹¹ ì¢…ëª©ì— ëŒ€í•œ ê°ì¢… ì •ë³´ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. ë¨¼ì € <code class="docutils literal notranslate"><span class="pre">asset_profile</span></code> ë¶€ë¶„ì—ëŠ” ê¸°ì—…ì— ëŒ€í•œ ì •ë³´ê°€ ë‚˜íƒ€ë‚œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">summary_detail</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;AAPL&#39;: {&#39;maxAge&#39;: 1,
  &#39;priceHint&#39;: 2,
  &#39;previousClose&#39;: 172.07,
  &#39;open&#39;: 171.71,
  &#39;dayLow&#39;: 170.422,
  &#39;dayHigh&#39;: 172.925,
  &#39;regularMarketPreviousClose&#39;: 172.07,
  &#39;regularMarketOpen&#39;: 171.71,
  &#39;regularMarketDayLow&#39;: 170.422,
  &#39;regularMarketDayHigh&#39;: 172.925,
  &#39;dividendRate&#39;: 0.96,
  &#39;dividendYield&#39;: 0.0056,
  &#39;exDividendDate&#39;: &#39;2023-05-12 09:00:00&#39;,
  &#39;payoutRatio&#39;: 0.1559,
  &#39;fiveYearAvgDividendYield&#39;: 0.92,
  &#39;beta&#39;: 1.296622,
  &#39;trailingPE&#39;: 29.219967,
  &#39;forwardPE&#39;: 26.4052,
  &#39;volume&#39;: 54958392,
  &#39;regularMarketVolume&#39;: 54958392,
  &#39;averageVolume&#39;: 58150286,
  &#39;averageVolume10days&#39;: 58186880,
  &#39;averageDailyVolume10Day&#39;: 58186880,
  &#39;bid&#39;: 0.0,
  &#39;ask&#39;: 0.0,
  &#39;bidSize&#39;: 3000,
  &#39;askSize&#39;: 800,
  &#39;marketCap&#39;: 2716189327360,
  &#39;fiftyTwoWeekLow&#39;: 124.17,
  &#39;fiftyTwoWeekHigh&#39;: 176.15,
  &#39;priceToSalesTrailing12Months&#39;: 7.0532966,
  &#39;fiftyDayAverage&#39;: 163.586,
  &#39;twoHundredDayAverage&#39;: 152.02135,
  &#39;trailingAnnualDividendRate&#39;: 0.92,
  &#39;trailingAnnualDividendYield&#39;: 0.005346661,
  &#39;currency&#39;: &#39;USD&#39;,
  &#39;fromCurrency&#39;: None,
  &#39;toCurrency&#39;: None,
  &#39;lastMarket&#39;: None,
  &#39;coinMarketCapLink&#39;: None,
  &#39;algorithm&#39;: None,
  &#39;tradeable&#39;: False}}
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">summary_detail</span></code> ë¶€ë¶„ì—ëŠ” ê°€ê²©, ë°°ë‹¹, ë°¸ë¥˜ì—ì´ì…˜ ë“± ì£¼ìš” ì§€í‘œê°€ ë‚˜íƒ€ë‚œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">history</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>volume</th>
      <th>adjclose</th>
      <th>dividends</th>
    </tr>
    <tr>
      <th>symbol</th>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">AAPL</th>
      <th>2023-01-03</th>
      <td>130.279999</td>
      <td>130.899994</td>
      <td>124.169998</td>
      <td>125.070000</td>
      <td>112117500</td>
      <td>124.706833</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2023-01-04</th>
      <td>126.889999</td>
      <td>128.660004</td>
      <td>125.080002</td>
      <td>126.360001</td>
      <td>89113600</td>
      <td>125.993095</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2023-01-05</th>
      <td>127.129997</td>
      <td>127.769997</td>
      <td>124.760002</td>
      <td>125.019997</td>
      <td>80962700</td>
      <td>124.656982</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2023-01-06</th>
      <td>126.010002</td>
      <td>130.289993</td>
      <td>124.889999</td>
      <td>129.619995</td>
      <td>87754700</td>
      <td>129.243622</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2023-01-09</th>
      <td>130.470001</td>
      <td>133.410004</td>
      <td>129.889999</td>
      <td>130.149994</td>
      <td>70790800</td>
      <td>129.772079</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">history()</span></code> ë¶€ë¶„ì„ í†µí•´ ì£¼ê°€ë¥¼ ë°›ì„ ìˆ˜ë„ ìˆë‹¤.</p>
<p>ì¬ë¬´ì œí‘œ ë°ì´í„°ì˜ ê²½ìš° <code class="docutils literal notranslate"><span class="pre">data.balance_sheet()</span></code>, <code class="docutils literal notranslate"><span class="pre">data.cash_flow()</span></code>, <code class="docutils literal notranslate"><span class="pre">data.income_statement()</span></code> ì„ í†µí•´ ì¬ë¬´ìƒíƒœí‘œ, í˜„ê¸ˆíë¦„í‘œ, ì†ìµê³„ì‚°ì„œë¥¼ ê°ê° ë°›ì„ ìˆ˜ë„ ìˆì§€ë§Œ, <code class="docutils literal notranslate"><span class="pre">data.all_financial_data()</span></code>ì„ í†µí•´ ì„¸ ê°œì˜ í…Œì´ë¸”ì„ í•œ ë²ˆì— ë°›ì„ ìˆ˜ë„ ìˆë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">all_financial_data</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">data_y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>asOfDate</th>
      <th>periodType</th>
      <th>currencyCode</th>
      <th>AccountsPayable</th>
      <th>AccountsReceivable</th>
      <th>AccumulatedDepreciation</th>
      <th>AvailableForSaleSecurities</th>
      <th>BasicAverageShares</th>
      <th>BasicEPS</th>
      <th>BeginningCashPosition</th>
      <th>...</th>
      <th>TotalDebt</th>
      <th>TotalEquityGrossMinorityInterest</th>
      <th>TotalExpenses</th>
      <th>TotalLiabilitiesNetMinorityInterest</th>
      <th>TotalNonCurrentAssets</th>
      <th>TotalNonCurrentLiabilitiesNetMinorityInterest</th>
      <th>TotalOperatingIncomeAsReported</th>
      <th>TotalRevenue</th>
      <th>TradeandOtherPayablesNonCurrent</th>
      <th>WorkingCapital</th>
    </tr>
    <tr>
      <th>symbol</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AAPL</th>
      <td>2019-09-30</td>
      <td>12M</td>
      <td>USD</td>
      <td>4.623600e+10</td>
      <td>2.292600e+10</td>
      <td>-5.857900e+10</td>
      <td>1.053410e+11</td>
      <td>1.847134e+10</td>
      <td>2.9925</td>
      <td>2.591300e+10</td>
      <td>...</td>
      <td>1.080470e+11</td>
      <td>9.048800e+10</td>
      <td>1.962440e+11</td>
      <td>2.480280e+11</td>
      <td>1.756970e+11</td>
      <td>1.423100e+11</td>
      <td>6.393000e+10</td>
      <td>2.601740e+11</td>
      <td>2.954500e+10</td>
      <td>5.710100e+10</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>2020-09-30</td>
      <td>12M</td>
      <td>USD</td>
      <td>4.229600e+10</td>
      <td>1.612000e+10</td>
      <td>-6.676000e+10</td>
      <td>1.008870e+11</td>
      <td>1.735212e+10</td>
      <td>3.3100</td>
      <td>5.022400e+10</td>
      <td>...</td>
      <td>1.124360e+11</td>
      <td>6.533900e+10</td>
      <td>2.082270e+11</td>
      <td>2.585490e+11</td>
      <td>1.801750e+11</td>
      <td>1.531570e+11</td>
      <td>6.628800e+10</td>
      <td>2.745150e+11</td>
      <td>2.817000e+10</td>
      <td>3.832100e+10</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>2021-09-30</td>
      <td>12M</td>
      <td>USD</td>
      <td>5.476300e+10</td>
      <td>2.627800e+10</td>
      <td>-7.028300e+10</td>
      <td>1.278770e+11</td>
      <td>1.670127e+10</td>
      <td>5.6700</td>
      <td>3.978900e+10</td>
      <td>...</td>
      <td>1.247190e+11</td>
      <td>6.309000e+10</td>
      <td>2.568680e+11</td>
      <td>2.879120e+11</td>
      <td>2.161660e+11</td>
      <td>1.624310e+11</td>
      <td>1.089490e+11</td>
      <td>3.658170e+11</td>
      <td>2.468900e+10</td>
      <td>9.355000e+09</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>2022-09-30</td>
      <td>12M</td>
      <td>USD</td>
      <td>6.411500e+10</td>
      <td>2.818400e+10</td>
      <td>-7.234000e+10</td>
      <td>1.208050e+11</td>
      <td>1.621596e+10</td>
      <td>6.1500</td>
      <td>3.592900e+10</td>
      <td>...</td>
      <td>1.200690e+11</td>
      <td>5.067200e+10</td>
      <td>2.748910e+11</td>
      <td>3.020830e+11</td>
      <td>2.173500e+11</td>
      <td>1.481010e+11</td>
      <td>1.194370e+11</td>
      <td>3.943280e+11</td>
      <td>1.665700e+10</td>
      <td>-1.857700e+10</td>
    </tr>
  </tbody>
</table>
<p>4 rows Ã— 155 columns</p>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">all_financial_data()</span></code>ë¥¼ ì…ë ¥í•˜ë©´ ì„¸ ê°œì˜ ì¬ë¬´ì œí‘œë¥¼ í•œ ë²ˆì— ë°›ì„ ìˆ˜ ìˆìœ¼ë©°, ì¸ìì— <code class="docutils literal notranslate"><span class="pre">frequency</span> <span class="pre">=</span> <span class="pre">'a'</span></code>ë¥¼ ì…ë ¥í•˜ë©´ ì—°ê°„(annual) ì¬ë¬´ì œí‘œë¥¼ ë°›ëŠ”ë‹¤. ì´ëŠ” ê°€ë¡œë¡œ ê¸´ í˜•íƒœì´ë¯€ë¡œ í´ë Œì§•ì²˜ë¦¬ë¥¼ í•´ì£¼ë„ë¡ í•œë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">data_y</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;periodType&#39;</span><span class="p">,</span> <span class="s1">&#39;currencyCode&#39;</span><span class="p">])]</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;asOfDate&#39;</span><span class="p">])</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">data_y</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
<span class="n">data_y</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">]</span>

<span class="n">data_y</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ticker</th>
      <th>date</th>
      <th>account</th>
      <th>value</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAPL</td>
      <td>2019-09-30</td>
      <td>AccountsPayable</td>
      <td>46236000000.0</td>
      <td>y</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAPL</td>
      <td>2020-09-30</td>
      <td>AccountsPayable</td>
      <td>42296000000.0</td>
      <td>y</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAPL</td>
      <td>2021-09-30</td>
      <td>AccountsPayable</td>
      <td>54763000000.0</td>
      <td>y</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAPL</td>
      <td>2022-09-30</td>
      <td>AccountsPayable</td>
      <td>64115000000.0</td>
      <td>y</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAPL</td>
      <td>2019-09-30</td>
      <td>AccountsReceivable</td>
      <td>22926000000.0</td>
      <td>y</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ol class="arabic simple">
<li><p>ì¸ë±ìŠ¤ë¥¼ ì´ˆê¸°í™”í•œë‹¤.</p></li>
<li><p>ë¶ˆí•„ìš”í•œ ì—´ì„ ì œì™¸í•œë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt()</span></code> í•¨ìˆ˜ë¥¼ í†µí•´ ì„¸ë¡œë¡œ ê¸´ í˜•íƒœë¡œ ë§Œë“ ë‹¤.</p></li>
<li><p>nanì„ Noneìœ¼ë¡œ ë³€ê²½í•œë‹¤.</p></li>
<li><p>freq ì—´ì— ì—°ê°„ì— í•´ë‹¹í•˜ëŠ” â€˜yâ€™ë¥¼ ì…ë ¥í•œë‹¤.</p></li>
<li><p>ì—´ ì´ë¦„ì„ ë³€ê²½í•œë‹¤.</p></li>
</ol>
<p>ì´ì²˜ëŸ¼ í•´ì™¸ ì¢…ëª©ì˜ ì¬ë¬´ì œí‘œ ë°ì´í„°ë„ ë§¤ìš° ì‰½ê²Œ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆë‹¤. ë¶„ê¸°ë³„ ì¬ë¬´ì œí‘œë¥¼ ë°›ëŠ”ë²•ë„ ìœ„ì™€ ê°™ìœ¼ë©°, ì¸ìë§Œ <code class="docutils literal notranslate"><span class="pre">frequency</span> <span class="pre">=</span> <span class="pre">'q'</span></code>ë¡œ ë³€ê²½í•˜ë©´ ëœë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_q</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">all_financial_data</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>
<span class="n">data_q</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">data_q</span> <span class="o">=</span> <span class="n">data_q</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">data_q</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;periodType&#39;</span><span class="p">,</span> <span class="s1">&#39;currencyCode&#39;</span><span class="p">])]</span>
<span class="n">data_q</span> <span class="o">=</span> <span class="n">data_q</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;asOfDate&#39;</span><span class="p">])</span>
<span class="n">data_q</span> <span class="o">=</span> <span class="n">data_q</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">data_q</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
<span class="n">data_q</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">]</span>

<span class="n">data_q</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ticker</th>
      <th>date</th>
      <th>account</th>
      <th>value</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAPL</td>
      <td>2022-03-31</td>
      <td>AccountsPayable</td>
      <td>52682000000.0</td>
      <td>q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AAPL</td>
      <td>2022-06-30</td>
      <td>AccountsPayable</td>
      <td>48343000000.0</td>
      <td>q</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AAPL</td>
      <td>2022-09-30</td>
      <td>AccountsPayable</td>
      <td>64115000000.0</td>
      <td>q</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AAPL</td>
      <td>2022-12-31</td>
      <td>AccountsPayable</td>
      <td>57918000000.0</td>
      <td>q</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAPL</td>
      <td>2023-03-31</td>
      <td>AccountsPayable</td>
      <td>42945000000.0</td>
      <td>q</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="id9">
<h3><span class="section-number">11.4.1. </span>ì „ ì¢…ëª© ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h3>
<p>forë¬¸ì„ ì´ìš©í•˜ì—¬ ì „ ì¢…ëª© ì¬ë¬´ì œí‘œë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ë„ë¡ í•˜ê² ë‹¤. ë¨¼ì € SQLì—ì„œ ì¬ë¬´ì œí‘œ ë°ì´í„°ì— í•´ë‹¹í•˜ëŠ” í…Œì´ë¸”(global_fs)ë¥¼ ë§Œë“ ë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">stock_db</span><span class="p">;</span>

<span class="n">create</span> <span class="n">table</span> <span class="n">global_fs</span>
<span class="p">(</span>
    <span class="n">ticker</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>        
    <span class="n">date</span> <span class="n">date</span><span class="p">,</span>
    <span class="n">account</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">value</span> <span class="n">double</span><span class="p">,</span>
    <span class="n">freq</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    
    <span class="n">primary</span> <span class="n">key</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>ì´ì œ íŒŒì´ì¬ì—ì„œ ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ forë¬¸ì„ í†µí•´ ì „ ì¢…ëª© ì¬ë¬´ì œí‘œê°€ DBì— ì €ì¥ëœë‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># íŒ¨í‚¤ì§€ ë¶ˆëŸ¬ì˜¤ê¸°</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">pymysql</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">yahooquery</span> <span class="kn">import</span> <span class="n">Ticker</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># DB ì—°ê²°</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;mysql+pymysql://root:1234@127.0.0.1:3306/stock_db&#39;</span><span class="p">)</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
                      <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span>
                      <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                      <span class="n">db</span><span class="o">=</span><span class="s1">&#39;stock_db&#39;</span><span class="p">,</span>
                      <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>

<span class="n">mycursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># í‹°ì»¤ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</span>
<span class="n">ticker_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select * from global_ticker</span>
<span class="s2">where date = (select max(date) from global_ticker)</span>
<span class="s2">and country = &#39;United States&#39;;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="c1"># DB ì €ì¥ ì¿¼ë¦¬</span>
<span class="n">query_fs</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    insert into global_fs (ticker, date, account, value, freq)</span>
<span class="s2">    values (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">) as new</span>
<span class="s2">    on duplicate key update</span>
<span class="s2">    value = new.value;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># ì˜¤ë¥˜ ë°œìƒì‹œ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸ ìƒì„±</span>
<span class="n">error_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># ì „ì¢…ëª© ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ ë° ì €ì¥</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ticker_list</span><span class="p">))):</span>

    <span class="c1"># í‹°ì»¤ ì„ íƒ</span>
    <span class="n">ticker</span> <span class="o">=</span> <span class="n">ticker_list</span><span class="p">[</span><span class="s1">&#39;Symbol&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># ì˜¤ë¥˜ ë°œìƒ ì‹œ ì´ë¥¼ ë¬´ì‹œí•˜ê³  ë‹¤ìŒ ë£¨í”„ë¡œ ì§„í–‰</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="c1">#  ì •ë³´ ë‹¤ìš´ë¡œë“œ</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Ticker</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        
        <span class="c1"># ì—°ê°„ ì¬ë¬´ì œí‘œ</span>
        <span class="n">data_y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">all_financial_data</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">data_y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">data_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">data_y</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;periodType&#39;</span><span class="p">,</span> <span class="s1">&#39;currencyCode&#39;</span><span class="p">])]</span>
        <span class="n">data_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;asOfDate&#39;</span><span class="p">])</span>
        <span class="n">data_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">data_y</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
        <span class="n">data_y</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        
        
        <span class="c1"># ë¶„ê¸° ì¬ë¬´ì œí‘œ</span>
        <span class="n">data_q</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">all_financial_data</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>
        <span class="n">data_q</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">data_q</span> <span class="o">=</span> <span class="n">data_q</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">data_q</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;periodType&#39;</span><span class="p">,</span> <span class="s1">&#39;currencyCode&#39;</span><span class="p">])]</span>
        <span class="n">data_q</span> <span class="o">=</span> <span class="n">data_q</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;asOfDate&#39;</span><span class="p">])</span>
        <span class="n">data_q</span> <span class="o">=</span> <span class="n">data_q</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">data_q</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;q&#39;</span>
        <span class="n">data_q</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        
        <span class="c1"># ë°ì´í„° í•©ì¹˜ê¸°</span>
        <span class="n">data_fs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_y</span><span class="p">,</span> <span class="n">data_q</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># ì¬ë¬´ì œí‘œ ë°ì´í„°ë¥¼ DBì— ì €ì¥</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">data_fs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">mycursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query_fs</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">except</span><span class="p">:</span>

        <span class="c1"># ì˜¤ë¥˜ ë°œìƒì‹œ error_listì— í‹°ì»¤ ì €ì¥í•˜ê³  ë„˜ì–´ê°€ê¸°</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

    <span class="c1"># íƒ€ì„ìŠ¬ë¦½ ì ìš©</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># DB ì—°ê²° ì¢…ë£Œ</span>
<span class="n">engine</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple">
<li><p>DBì— ì—°ê²°í•œë‹¤.</p></li>
<li><p>ê¸°ì¤€ì¼ì´ ìµœëŒ€, ì¦‰ ìµœê·¼ì¼ ê¸°ì¤€ ë³´í†µì£¼ì— í•´ë‹¹í•˜ë©°, ë¯¸êµ­ ì¢…ëª©ì˜ ë¦¬ìŠ¤íŠ¸(ticker_list)ë§Œ ë¶ˆëŸ¬ì˜¨ë‹¤.</p></li>
<li><p>DBì— ì €ì¥í•  ì¿¼ë¦¬(query)ë¥¼ ì…ë ¥í•œë‹¤.</p></li>
<li><p>í˜ì´ì§€ ì˜¤ë¥˜, í†µì‹  ì˜¤ë¥˜ ë“± ì˜¤ë¥˜ê°€ ë°œìƒí•œ í‹°ì»¤ëª…ì„ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸(error_list)ë¥¼ ë§Œë“ ë‹¤.</p></li>
<li><p>forë¬¸ì„ í†µí•´ ì „ì¢…ëª© ì¬ë¬´ì œí‘œë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ìœ¼ë©°, ì§„í–‰ìƒí™©ì„ ì•Œê¸°ìœ„í•´ tqdm() í•¨ìˆ˜ë¥¼ ì´ìš©í•œë‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Ticker()</span></code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ì¢…ëª© ë°ì´í„°ë¥¼ ë°›ì€ í›„ ì—°ê°„ ë° ë¶„ê¸° ì¬ë¬´ì œí‘œë¥¼ êµ¬í•œë‹¤.</p></li>
<li><p>ì´í›„, ë‘ í…Œì´ë¸”ì„ concat() í•¨ìˆ˜ë¥¼ í†µí•´ í–‰ìœ¼ë¡œ ë¬¶ì–´ì¤€ë‹¤.</p></li>
<li><p>ì¬ë¬´ì œí‘œ ë°ì´í„°ë¥¼ DBì— ì €ì¥í•œë‹¤.</p></li>
<li><p>ë¬´í•œ í¬ë¡¤ë§ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ í•œ ë²ˆì˜ ë£¨í”„ê°€ ëë‚  ë•Œë§ˆë‹¤ íƒ€ì„ìŠ¬ë¦½ì„ ì ìš©í•œë‹¤.</p></li>
<li><p>ëª¨ë“  ì‘ì—…ì´ ëë‚˜ë©´ DBì™€ì˜ ì—°ê²°ì„ ì¢…ë£Œí•œë‹¤.</p></li>
</ol>
<figure class="align-default" id="sql-fs">
<img alt="_images/sql_fs.png" src="_images/sql_fs.png" />
<figcaption>
<p><span class="caption-number">Fig. 11.16 </span><span class="caption-text">ê¸€ë¡œë²Œ ì¬ë¬´ì œí‘œ í…Œì´ë¸”</span><a class="headerlink" href="#sql-fs" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ë¯¸êµ­ ì¢…ëª©ë“¤ì˜ ê°€ì¹˜ì§€í‘œëŠ” êµ­ë‚´ ì¬ë¬´ì œí‘œ ë°ì´í„°ë¥¼ ì´ìš©í•´ ê°€ì¹˜ì§€í‘œë¥¼ ê³„ì‚°í–ˆë˜ ê²ƒê³¼ ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ê³„ì‚°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì´ëŠ” ìƒëµí•˜ë„ë¡ í•œë‹¤.</p>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="data_korea.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">10. </span>êµ­ë‚´ ì£¼ì‹ ë°ì´í„° ìˆ˜ì§‘</p>
      </div>
    </a>
    <a class="right-next"
       href="data_ref.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">12. </span>íˆ¬ì ì°¸ê³ ìš© ë°ì´í„° ìˆ˜ì§‘</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">11.1. ìœ ë£Œ ë°ì´í„° ë²¤ë” ì´ìš©í•˜ê¸°</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#api-token">11.1.1. ê°€ì… ë° API token ë°›ê¸°</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">11.1.2. ë°ì´í„° ë‹¤ìš´ë¡œë“œ</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">11.2. í‹°ì»¤ ìˆ˜ì§‘í•˜ê¸°</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">11.2.1. ì „ ì¢…ëª© í‹°ì»¤ í¬ë¡¤ë§</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">11.3. ì£¼ê°€ ë‹¤ìš´ë¡œë“œ</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">11.3.1. ì „ ì¢…ëª© ì£¼ê°€ ë‹¤ìš´ë¡œë“œ</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">11.4. ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">11.4.1. ì „ ì¢…ëª© ì¬ë¬´ì œí‘œ ë‹¤ìš´ë¡œë“œ</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By ì´í˜„ì—´
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>